<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<title>GeneralReflection</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library GeneralReflection</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">MetaCoq.Checker.Checker</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">MetaCoq.Template</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">utils</span> <span class="id" title="keyword">All</span> <span class="id" title="var">Pretty</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">List</span> <span class="id" title="var">String</span>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">MonadNotation</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">FOL</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Deduction</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Tarski</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">VectorTech</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Lia</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab1"></a><h1 class="section">Reification</h1>

      Please read the PDF file giving a detailed description.

<div class="paragraph"> </div>

      We are given a Coq term and try to find a reification of it in the syntax of a specific kind of first-order theory. 
</div>
<div class="code">
<span class="id" title="keyword">Section</span> <span class="id" title="var">FailureMonad</span>.<br/>
</div>

<div class="doc">
<a id="lab2"></a><h2 class="section">FailureMonad</h2>

      Since our function is partial, and we want to give helpful error messages to the User, we use this monad, which represents either success or failure, along with an error message
  
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Inductive</span> <span class="id" title="var">FailureMonad</span> (<span class="id" title="var">A</span>:<span class="id" title="keyword">Type</span>) : <span class="id" title="keyword">Type</span> := <span class="id" title="var">ret</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">FailureMonad</span> <span class="id" title="var">A</span> | <span class="id" title="tactic">fail</span> : <span class="id" title="var">string</span> -&gt; <span class="id" title="var">FailureMonad</span> <span class="id" title="var">A</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">Arguments</span> <span class="id" title="var">ret</span> {<span class="id" title="var">_</span>} <span class="id" title="var">_</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">Arguments</span> <span class="id" title="tactic">fail</span> {<span class="id" title="var">_</span>} <span class="id" title="var">_</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">bind</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">k</span>:<span class="id" title="var">FailureMonad</span> <span class="id" title="var">A</span>) (<span class="id" title="var">f</span>:<span class="id" title="var">A</span> -&gt; <span class="id" title="var">FailureMonad</span> <span class="id" title="var">B</span>) := <span class="id" title="keyword">match</span> <span class="id" title="var">k</span> <span class="id" title="keyword">return</span> <span class="id" title="var">FailureMonad</span> <span class="id" title="var">B</span> <span class="id" title="keyword">with</span> <span class="id" title="tactic">fail</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="tactic">fail</span> <span class="id" title="var">x</span> | <span class="id" title="var">ret</span> <span class="id" title="var">k</span> =&gt; <span class="id" title="var">f</span> <span class="id" title="var">k</span> <span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> &quot;x &lt;- c1 ;; c2" := (<span class="id" title="var">bind</span> <span class="id" title="var">c1</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">c2</span>)).<br/>
</div>

<div class="doc">
"Converts" from our monad to the TemplateMonad of MetaCoq. This is used to pass error messages back to the user 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">f2t</span> {<span class="id" title="var">T</span>:<span class="id" title="keyword">Type</span>} (<span class="id" title="var">a</span>:<span class="id" title="var">FailureMonad</span> <span class="id" title="var">T</span>) : <span class="id" title="var">TemplateMonad</span> <span class="id" title="var">T</span> := <span class="id" title="keyword">match</span> <span class="id" title="var">a</span> <span class="id" title="keyword">with</span> <span class="id" title="var">ret</span> <span class="id" title="var">k</span> =&gt; <span class="id" title="var">monad_utils.ret</span> <span class="id" title="var">k</span> | <span class="id" title="tactic">fail</span> <span class="id" title="var">s</span> =&gt; <span class="id" title="var">tmFail</span> <span class="id" title="var">s</span> <span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
Structurally recursive definition of a monadic map 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">flatten_monad</span> {<span class="id" title="var">A</span>:<span class="id" title="keyword">Type</span>} (<span class="id" title="var">l</span>:<span class="id" title="var">list</span> (<span class="id" title="var">FailureMonad</span> <span class="id" title="var">A</span>)) : <span class="id" title="var">FailureMonad</span> (<span class="id" title="var">list</span> <span class="id" title="var">A</span>) := <span class="id" title="keyword">match</span> <span class="id" title="var">l</span> <span class="id" title="keyword">with</span> <span class="id" title="var">nil</span> =&gt; <span class="id" title="var">ret</span> <span class="id" title="var">nil</span> | <span class="id" title="var">x</span>::<span class="id" title="var">xr</span> =&gt; <span class="id" title="var">xm</span> &lt;- <span class="id" title="var">x</span>;; <span class="id" title="var">xrm</span> &lt;- <span class="id" title="var">flatten_monad</span> <span class="id" title="var">xr</span>;; <span class="id" title="var">ret</span> (<span class="id" title="var">xm</span>::<span class="id" title="var">xrm</span>) <span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">map_monad</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span>:<span class="id" title="keyword">Type</span>} (<span class="id" title="var">f</span>:<span class="id" title="var">A</span> -&gt; <span class="id" title="var">FailureMonad</span> <span class="id" title="var">B</span>) (<span class="id" title="var">l</span>:<span class="id" title="var">list</span> <span class="id" title="var">A</span>) : <span class="id" title="var">FailureMonad</span> (<span class="id" title="var">list</span> <span class="id" title="var">B</span>) := <span class="id" title="var">flatten_monad</span> (<span class="id" title="var">map</span> <span class="id" title="var">f</span> <span class="id" title="var">l</span>).<br/>
</div>

<div class="doc">
If the first monad fails, use the second. Used to cascade failure handling 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">orelse</span> {<span class="id" title="var">A</span>:<span class="id" title="keyword">Type</span>} (<span class="id" title="var">F1</span> <span class="id" title="var">F2</span> :<span class="id" title="var">FailureMonad</span> <span class="id" title="var">A</span>) := <span class="id" title="keyword">match</span> <span class="id" title="var">F1</span> <span class="id" title="keyword">with</span> <span class="id" title="tactic">fail</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">F2</span> | <span class="id" title="var">_</span> =&gt; <span class="id" title="var">F1</span> <span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">FailureMonad</span>.<br/>

<br/>
<span class="id" title="var">Arguments</span> <span class="id" title="var">ret</span> {<span class="id" title="var">_</span>} <span class="id" title="var">_</span>.<br/>
<span class="id" title="var">Arguments</span> <span class="id" title="tactic">fail</span> {<span class="id" title="var">_</span>} <span class="id" title="var">_</span>.<br/>
<span class="id" title="var">Arguments</span> <span class="id" title="var">orelse</span> {<span class="id" title="var">_</span>} <span class="id" title="var">_</span> <span class="id" title="var">_</span>.<br/>
<span class="id" title="keyword">Notation</span> &quot;x &lt;- c1 ;; c2" := (<span class="id" title="var">bind</span> <span class="id" title="var">c1</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">c2</span>)).<br/>
<span class="id" title="var">Arguments</span> <span class="id" title="var">Vector.cons</span> {<span class="id" title="var">_</span>} <span class="id" title="var">_</span> {<span class="id" title="var">_</span>} <span class="id" title="var">_</span>, <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">MetaCoqUtils</span>.<br/>
</div>

<div class="doc">
<a id="lab3"></a><h2 class="section">MetaCoqUtils</h2>

         Here, we define various useful functions for working with MetaCoq terms 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> <span class="id" title="var">vectorCons</span> <span class="id" title="var">x</span> <span class="id" title="var">T</span> <span class="id" title="var">n</span> <span class="id" title="var">xr</span> := <br/>
&nbsp;&nbsp;(<span class="id" title="var">tApp</span><br/>
&nbsp;&nbsp;&nbsp;(<span class="id" title="var">tConstruct</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inductive_mind</span> := (<span class="id" title="var">MPfile</span> (["VectorDef"; "Vectors"; "Coq"]), "t");<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inductive_ind</span> := 0 |} 1 <span class="id" title="var">nil</span>)<br/>
&nbsp;&nbsp;&nbsp;([<span class="id" title="var">T</span>; <span class="id" title="var">x</span>; <span class="id" title="var">n</span>; <span class="id" title="var">xr</span>])).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> <span class="id" title="var">vectorNil</span> <span class="id" title="var">T</span> :=<br/>
&nbsp;&nbsp;(<span class="id" title="var">tApp</span><br/>
&nbsp;&nbsp;&nbsp;(<span class="id" title="var">tConstruct</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inductive_mind</span> := (<span class="id" title="var">MPfile</span> (["VectorDef"; "Vectors"; "Coq"]), "t");<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inductive_ind</span> := 0 |} 0 <span class="id" title="var">nil</span>) ([<span class="id" title="var">T</span>])).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">recoverVector</span> (<span class="id" title="var">f</span> : <span class="id" title="var">Ast.term</span>) {<span class="id" title="keyword">struct</span> <span class="id" title="var">f</span>}: <span class="id" title="var">FailureMonad</span> (<span class="id" title="var">list</span> <span class="id" title="var">Ast.term</span>) := <span class="id" title="keyword">let</span> <span class="id" title="var">ffail</span> := <span class="id" title="tactic">fail</span> "not a vector application" <span class="id" title="tactic">in</span> <span class="id" title="keyword">match</span> <span class="id" title="var">f</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">vectorNil</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">ret</span> <span class="id" title="var">nil</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">vectorCons</span> <span class="id" title="var">x</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">xr</span> =&gt; <span class="id" title="var">xrl</span> &lt;- <span class="id" title="var">recoverVector</span> <span class="id" title="var">xr</span>;;<span class="id" title="var">ret</span> (<span class="id" title="var">x</span>::<span class="id" title="var">xrl</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">ffail</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a id="lab4"></a><h3 class="section">General utils for quoted terms</h3>
 Remove the n first elements from a list 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="var">Existing</span> <span class="id" title="keyword">Instance</span> <span class="id" title="var">config.default_checker_flags</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">popNElements</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">Ast.term</span>) (<span class="id" title="var">n</span>:<span class="id" title="var">nat</span>) : <span class="id" title="var">option</span> (<span class="id" title="var">list</span> <span class="id" title="var">Ast.term</span>) := <span class="id" title="keyword">match</span> (<span class="id" title="var">l</span>,<span class="id" title="var">n</span>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">a</span>,0) =&gt; <span class="id" title="var">Some</span> <span class="id" title="var">a</span><br/>
&nbsp;&nbsp;| (<span class="id" title="var">x</span>::<span class="id" title="var">xr</span>, <span class="id" title="var">S</span> <span class="id" title="var">n</span>) =&gt; <span class="id" title="var">popNElements</span> <span class="id" title="var">xr</span> <span class="id" title="var">n</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">None</span> <span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
If ls is a valid prefix of l, return the corresponding "suffix" (the remaining elements of l). Otherwise, return None 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">popListStart</span> (<span class="id" title="var">l</span> : <span class="id" title="var">list</span> <span class="id" title="var">Ast.term</span>) (<span class="id" title="var">ls</span> : <span class="id" title="var">list</span> <span class="id" title="var">Ast.term</span>) : <span class="id" title="var">option</span> (<span class="id" title="var">list</span> <span class="id" title="var">Ast.term</span>) := <span class="id" title="keyword">match</span> (<span class="id" title="var">l</span>,<span class="id" title="var">ls</span>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">a</span>,<span class="id" title="var">nil</span>)=&gt; <span class="id" title="var">Some</span> <span class="id" title="var">a</span><br/>
&nbsp;&nbsp;| (<span class="id" title="var">lx</span>::<span class="id" title="var">lxr</span>, <span class="id" title="var">lsx</span>::<span class="id" title="var">lsxr</span>) =&gt; <span class="id" title="keyword">if</span> <span class="id" title="var">Checker.eq_term</span> <span class="id" title="var">init_graph</span> <span class="id" title="var">lx</span> <span class="id" title="var">lsx</span> <span class="id" title="keyword">then</span> <span class="id" title="var">popListStart</span> <span class="id" title="var">lxr</span> <span class="id" title="var">lsxr</span> <span class="id" title="keyword">else</span> <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">None</span> <span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">MetaCoq</span> <span class="id" title="var">Quote</span> <span class="id" title="keyword">Definition</span> <span class="id" title="var">qNatZero</span> := 0.<br/>
&nbsp;&nbsp;<span class="id" title="var">MetaCoq</span> <span class="id" title="var">Quote</span> <span class="id" title="keyword">Definition</span> <span class="id" title="var">qNatSucc</span> := <span class="id" title="var">S</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">MetaCoq</span> <span class="id" title="var">Quote</span> <span class="id" title="keyword">Definition</span> <span class="id" title="var">qeq_refl</span> := (@<span class="id" title="var">eq_refl</span>).<br/>
</div>

<div class="doc">
Given n, yield a MetaCoq Ast.term representation of n 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">quoteNumber</span> (<span class="id" title="var">n</span>:<span class="id" title="var">nat</span>) : <span class="id" title="var">Ast.term</span>:= <span class="id" title="keyword">match</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span> 0 =&gt; <span class="id" title="var">qNatZero</span> | <span class="id" title="var">S</span> <span class="id" title="var">n</span> =&gt; <span class="id" title="var">tApp</span> <span class="id" title="var">qNatSucc</span> ([<span class="id" title="var">quoteNumber</span> <span class="id" title="var">n</span>]) <span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Increases the indices of all tRel in t by amnt, assuming they are already larger than minn. If minn = 0, this increases all "free" tRel reference indices 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">addRelIndex</span> (<span class="id" title="var">minn</span>:<span class="id" title="var">nat</span>) (<span class="id" title="var">amnt</span>:<span class="id" title="var">nat</span>) (<span class="id" title="var">t</span>:<span class="id" title="var">Ast.term</span>) : <span class="id" title="var">Ast.term</span> := <span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">tRel</span> <span class="id" title="var">n</span> =&gt; <span class="id" title="keyword">if</span> <span class="id" title="var">Compare_dec.le_gt_dec</span> <span class="id" title="var">minn</span> <span class="id" title="var">n</span> <span class="id" title="keyword">then</span> <span class="id" title="var">tRel</span> (<span class="id" title="var">amnt</span>+<span class="id" title="var">n</span>) <span class="id" title="keyword">else</span> <span class="id" title="var">tRel</span> <span class="id" title="var">n</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">tVar</span> <span class="id" title="var">k</span> =&gt; <span class="id" title="var">tVar</span> <span class="id" title="var">k</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">tEvar</span> <span class="id" title="var">n</span> <span class="id" title="var">ls</span> =&gt; <span class="id" title="var">tEvar</span> <span class="id" title="var">n</span> (<span class="id" title="var">map</span> (<span class="id" title="var">addRelIndex</span> <span class="id" title="var">minn</span> <span class="id" title="var">amnt</span>) <span class="id" title="var">ls</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">tSort</span> <span class="id" title="var">u</span> =&gt; <span class="id" title="var">tSort</span> <span class="id" title="var">u</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">tCast</span> <span class="id" title="var">t</span> <span class="id" title="var">ck</span> <span class="id" title="var">t2</span> =&gt; <span class="id" title="var">tCast</span> (<span class="id" title="var">addRelIndex</span> <span class="id" title="var">minn</span> <span class="id" title="var">amnt</span> <span class="id" title="var">t</span>) <span class="id" title="var">ck</span> (<span class="id" title="var">addRelIndex</span> <span class="id" title="var">minn</span> <span class="id" title="var">amnt</span> <span class="id" title="var">t2</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">tProd</span> <span class="id" title="var">n</span> <span class="id" title="var">t</span> <span class="id" title="var">v</span> =&gt; <span class="id" title="var">tProd</span> <span class="id" title="var">n</span> (<span class="id" title="var">addRelIndex</span> <span class="id" title="var">minn</span> <span class="id" title="var">amnt</span> <span class="id" title="var">t</span>) (<span class="id" title="var">addRelIndex</span> (<span class="id" title="var">S</span> <span class="id" title="var">minn</span>) <span class="id" title="var">amnt</span> <span class="id" title="var">v</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">tLambda</span> <span class="id" title="var">n</span> <span class="id" title="var">t</span> <span class="id" title="var">v</span> =&gt; <span class="id" title="var">tLambda</span> <span class="id" title="var">n</span> (<span class="id" title="var">addRelIndex</span> <span class="id" title="var">minn</span> <span class="id" title="var">amnt</span> <span class="id" title="var">t</span>) (<span class="id" title="var">addRelIndex</span> (<span class="id" title="var">S</span> <span class="id" title="var">minn</span>) <span class="id" title="var">amnt</span> <span class="id" title="var">v</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">tLetIn</span> <span class="id" title="var">n</span> <span class="id" title="var">t</span> <span class="id" title="var">v</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="var">tLetIn</span> <span class="id" title="var">n</span> (<span class="id" title="var">addRelIndex</span> <span class="id" title="var">minn</span> <span class="id" title="var">amnt</span> <span class="id" title="var">t</span>) (<span class="id" title="var">addRelIndex</span> <span class="id" title="var">minn</span> <span class="id" title="var">amnt</span> <span class="id" title="var">v</span>) (<span class="id" title="var">addRelIndex</span> (<span class="id" title="var">S</span> <span class="id" title="var">minn</span>) <span class="id" title="var">amnt</span> <span class="id" title="var">e</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">tApp</span> <span class="id" title="var">f</span> <span class="id" title="var">al</span> =&gt; <span class="id" title="var">tApp</span> (<span class="id" title="var">addRelIndex</span> <span class="id" title="var">minn</span> <span class="id" title="var">amnt</span> <span class="id" title="var">f</span>) (<span class="id" title="var">map</span> (<span class="id" title="var">addRelIndex</span> <span class="id" title="var">minn</span> <span class="id" title="var">amnt</span>) <span class="id" title="var">al</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">tConst</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> =&gt; <span class="id" title="var">tConst</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">tInd</span> <span class="id" title="var">i</span> <span class="id" title="var">t</span> =&gt; <span class="id" title="var">tInd</span> <span class="id" title="var">i</span> <span class="id" title="var">t</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">tConstruct</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span> =&gt; <span class="id" title="var">tConstruct</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">tCase</span> <span class="id" title="var">k</span> <span class="id" title="var">i</span> <span class="id" title="var">r</span> <span class="id" title="var">m</span> =&gt; <span class="id" title="var">tCase</span> <span class="id" title="var">k</span> (<span class="id" title="var">addRelIndex</span> <span class="id" title="var">minn</span> <span class="id" title="var">amnt</span> <span class="id" title="var">i</span>) (<span class="id" title="var">addRelIndex</span> <span class="id" title="var">minn</span> <span class="id" title="var">amnt</span> <span class="id" title="var">r</span>) (<span class="id" title="var">map</span> (<span class="id" title="keyword">fun</span> '(<span class="id" title="var">a</span>,<span class="id" title="var">b</span>) =&gt; (<span class="id" title="var">a</span>,<span class="id" title="var">addRelIndex</span> <span class="id" title="var">minn</span> <span class="id" title="var">amnt</span> <span class="id" title="var">b</span>)) <span class="id" title="var">m</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">tProj</span> <span class="id" title="var">p</span> <span class="id" title="var">t</span> =&gt; <span class="id" title="var">tProj</span> <span class="id" title="var">p</span> (<span class="id" title="var">addRelIndex</span> <span class="id" title="var">minn</span> <span class="id" title="var">amnt</span> <span class="id" title="var">t</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">tFix</span> <span class="id" title="var">mft</span> <span class="id" title="var">n</span> =&gt; <span class="id" title="var">tFix</span> (<span class="id" title="var">map</span> (<span class="id" title="var">map_def</span> (<span class="id" title="var">addRelIndex</span> <span class="id" title="var">minn</span> <span class="id" title="var">amnt</span>) (<span class="id" title="var">addRelIndex</span> (<span class="id" title="var">S</span> <span class="id" title="var">minn</span>) <span class="id" title="var">amnt</span>)) <span class="id" title="var">mft</span>) <span class="id" title="var">n</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">tCoFix</span> <span class="id" title="var">mft</span> <span class="id" title="var">n</span> =&gt; <span class="id" title="var">tCoFix</span> (<span class="id" title="var">map</span> (<span class="id" title="var">map_def</span> (<span class="id" title="var">addRelIndex</span> <span class="id" title="var">minn</span> <span class="id" title="var">amnt</span>) (<span class="id" title="var">addRelIndex</span> (<span class="id" title="var">S</span> <span class="id" title="var">minn</span>) <span class="id" title="var">amnt</span>)) <span class="id" title="var">mft</span>) <span class="id" title="var">n</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">map_def_monad</span> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> : <span class="id" title="keyword">Type</span>} (<span class="id" title="var">tyf</span> <span class="id" title="var">bodyf</span> : <span class="id" title="var">A</span> -&gt; <span class="id" title="var">FailureMonad</span> <span class="id" title="var">B</span>) (<span class="id" title="var">d</span>:<span class="id" title="var">def</span> <span class="id" title="var">A</span>) : <span class="id" title="var">FailureMonad</span> (<span class="id" title="var">def</span> <span class="id" title="var">B</span>) := <span class="id" title="var">dtr</span> &lt;- <span class="id" title="var">tyf</span> (<span class="id" title="var">dbody</span> <span class="id" title="var">d</span>);;<span class="id" title="var">dbr</span> &lt;- <span class="id" title="var">bodyf</span> (<span class="id" title="var">dbody</span> <span class="id" title="var">d</span>);; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ret</span> {| <span class="id" title="var">dname</span> := <span class="id" title="var">dname</span> <span class="id" title="var">d</span>; <span class="id" title="var">dtype</span> := <span class="id" title="var">dtr</span>; <span class="id" title="var">dbody</span> := <span class="id" title="var">dbr</span>; <span class="id" title="var">rarg</span> := <span class="id" title="var">rarg</span> <span class="id" title="var">d</span> |}.<br/>
</div>

<div class="doc">
Inverse operation to addRelIndex. Can fail, if the term for instance contains a tRel 0, which would need to be lowered to tRel (-1), which does not exist 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">lowerRelIndex</span> (<span class="id" title="var">minn</span>:<span class="id" title="var">nat</span>) (<span class="id" title="var">tv</span>:<span class="id" title="var">FailureMonad</span> <span class="id" title="var">Ast.term</span>) (<span class="id" title="var">t</span>:<span class="id" title="var">Ast.term</span>) {<span class="id" title="keyword">struct</span> <span class="id" title="var">t</span>}: <span class="id" title="var">FailureMonad</span> <span class="id" title="var">Ast.term</span> := <span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">tRel</span> <span class="id" title="var">n</span> =&gt; <span class="id" title="keyword">if</span> <span class="id" title="var">Compare_dec.le_gt_dec</span> <span class="id" title="var">minn</span> <span class="id" title="var">n</span> <span class="id" title="keyword">then</span> <span class="id" title="keyword">if</span> <span class="id" title="var">Compare_dec.le_gt_dec</span> <span class="id" title="var">minn</span> (<span class="id" title="var">S</span> <span class="id" title="var">n</span>) <span class="id" title="keyword">then</span> <span class="id" title="var">ret</span> (<span class="id" title="var">tRel</span> (<span class="id" title="keyword">match</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span> 0 =&gt; 0 | <span class="id" title="var">S</span> <span class="id" title="var">n</span> =&gt; <span class="id" title="var">n</span> <span class="id" title="keyword">end</span>)) <span class="id" title="keyword">else</span> <span class="id" title="var">tv</span> <span class="id" title="keyword">else</span> <span class="id" title="var">ret</span> (<span class="id" title="var">tRel</span> <span class="id" title="var">n</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">tVar</span> <span class="id" title="var">k</span> =&gt; <span class="id" title="var">ret</span> (<span class="id" title="var">tVar</span> <span class="id" title="var">k</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">tEvar</span> <span class="id" title="var">n</span> <span class="id" title="var">ls</span> =&gt; <span class="id" title="var">m</span> &lt;- <span class="id" title="var">map_monad</span> (<span class="id" title="var">lowerRelIndex</span> <span class="id" title="var">minn</span> <span class="id" title="var">tv</span>) <span class="id" title="var">ls</span>;;<span class="id" title="var">ret</span> (<span class="id" title="var">tEvar</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">tSort</span> <span class="id" title="var">u</span> =&gt; <span class="id" title="var">ret</span> (<span class="id" title="var">tSort</span> <span class="id" title="var">u</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">tCast</span> <span class="id" title="var">t</span> <span class="id" title="var">ck</span> <span class="id" title="var">t2</span> =&gt; <span class="id" title="var">mt</span> &lt;- (<span class="id" title="var">lowerRelIndex</span> <span class="id" title="var">minn</span> <span class="id" title="var">tv</span> <span class="id" title="var">t</span>);;<span class="id" title="var">mt2</span>&lt;-(<span class="id" title="var">lowerRelIndex</span> <span class="id" title="var">minn</span> <span class="id" title="var">tv</span> <span class="id" title="var">t2</span>);;<span class="id" title="var">ret</span> (<span class="id" title="var">tCast</span> <span class="id" title="var">mt</span> <span class="id" title="var">ck</span> <span class="id" title="var">mt2</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">tProd</span> <span class="id" title="var">n</span> <span class="id" title="var">t</span> <span class="id" title="var">v</span> =&gt; <span class="id" title="var">mt</span>&lt;-(<span class="id" title="var">lowerRelIndex</span> <span class="id" title="var">minn</span> <span class="id" title="var">tv</span> <span class="id" title="var">t</span>);;<span class="id" title="var">mv</span>&lt;-(<span class="id" title="var">lowerRelIndex</span> (<span class="id" title="var">S</span> <span class="id" title="var">minn</span>) <span class="id" title="var">tv</span> <span class="id" title="var">v</span>);;<span class="id" title="var">ret</span> (<span class="id" title="var">tProd</span> <span class="id" title="var">n</span> <span class="id" title="var">mt</span> <span class="id" title="var">mv</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">tLambda</span> <span class="id" title="var">n</span> <span class="id" title="var">t</span> <span class="id" title="var">v</span> =&gt; <span class="id" title="var">mt</span>&lt;-(<span class="id" title="var">lowerRelIndex</span> <span class="id" title="var">minn</span> <span class="id" title="var">tv</span> <span class="id" title="var">t</span>);;<span class="id" title="var">mv</span>&lt;-(<span class="id" title="var">lowerRelIndex</span> (<span class="id" title="var">S</span> <span class="id" title="var">minn</span>) <span class="id" title="var">tv</span> <span class="id" title="var">v</span>);;<span class="id" title="var">ret</span> (<span class="id" title="var">tLambda</span> <span class="id" title="var">n</span> <span class="id" title="var">mt</span> <span class="id" title="var">mv</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">tLetIn</span> <span class="id" title="var">n</span> <span class="id" title="var">t</span> <span class="id" title="var">v</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="var">mt</span>&lt;-(<span class="id" title="var">lowerRelIndex</span> <span class="id" title="var">minn</span> <span class="id" title="var">tv</span> <span class="id" title="var">t</span>);;<span class="id" title="var">mv</span>&lt;-(<span class="id" title="var">lowerRelIndex</span> <span class="id" title="var">minn</span> <span class="id" title="var">tv</span> <span class="id" title="var">v</span>);;<span class="id" title="var">me</span>&lt;-(<span class="id" title="var">lowerRelIndex</span> (<span class="id" title="var">S</span> <span class="id" title="var">minn</span>) <span class="id" title="var">tv</span> <span class="id" title="var">e</span>);;<span class="id" title="var">ret</span> (<span class="id" title="var">tLetIn</span> <span class="id" title="var">n</span> <span class="id" title="var">mt</span> <span class="id" title="var">mv</span> <span class="id" title="var">me</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">tApp</span> <span class="id" title="var">f</span> <span class="id" title="var">al</span> =&gt; <span class="id" title="var">mal</span>&lt;-(<span class="id" title="var">map_monad</span> (<span class="id" title="var">lowerRelIndex</span> <span class="id" title="var">minn</span> <span class="id" title="var">tv</span>) <span class="id" title="var">al</span>);;<span class="id" title="var">ff</span> &lt;- <span class="id" title="var">lowerRelIndex</span> <span class="id" title="var">minn</span> <span class="id" title="var">tv</span> <span class="id" title="var">f</span>;;<span class="id" title="var">ret</span> (<span class="id" title="var">tApp</span> <span class="id" title="var">ff</span> <span class="id" title="var">mal</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">tConst</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> =&gt; <span class="id" title="var">ret</span> (<span class="id" title="var">tConst</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">tInd</span> <span class="id" title="var">i</span> <span class="id" title="var">t</span> =&gt; <span class="id" title="var">ret</span> (<span class="id" title="var">tInd</span> <span class="id" title="var">i</span> <span class="id" title="var">t</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">tConstruct</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span> =&gt; <span class="id" title="var">ret</span> (<span class="id" title="var">tConstruct</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">tCase</span> <span class="id" title="var">k</span> <span class="id" title="var">i</span> <span class="id" title="var">r</span> <span class="id" title="var">m</span> =&gt; <span class="id" title="var">mi</span>&lt;-(<span class="id" title="var">lowerRelIndex</span> <span class="id" title="var">minn</span> <span class="id" title="var">tv</span> <span class="id" title="var">i</span>);;<span class="id" title="var">mr</span>&lt;-(<span class="id" title="var">lowerRelIndex</span> <span class="id" title="var">minn</span> <span class="id" title="var">tv</span> <span class="id" title="var">r</span>);;<span class="id" title="var">mm</span>&lt;-(<span class="id" title="var">map_monad</span> (<span class="id" title="keyword">fun</span> '(<span class="id" title="var">a</span>,<span class="id" title="var">b</span>) =&gt; <span class="id" title="var">mb</span> &lt;- <span class="id" title="var">lowerRelIndex</span> <span class="id" title="var">minn</span> <span class="id" title="var">tv</span> <span class="id" title="var">b</span>;; <span class="id" title="var">ret</span> (<span class="id" title="var">a</span>,<span class="id" title="var">mb</span>)) <span class="id" title="var">m</span>);;<span class="id" title="var">ret</span> (<span class="id" title="var">tCase</span> <span class="id" title="var">k</span> <span class="id" title="var">mi</span> <span class="id" title="var">mr</span> <span class="id" title="var">mm</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">tProj</span> <span class="id" title="var">p</span> <span class="id" title="var">t</span> =&gt; <span class="id" title="var">mt</span>&lt;-(<span class="id" title="var">lowerRelIndex</span> <span class="id" title="var">minn</span> <span class="id" title="var">tv</span> <span class="id" title="var">t</span>);;<span class="id" title="var">ret</span> (<span class="id" title="var">tProj</span> <span class="id" title="var">p</span> <span class="id" title="var">mt</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">tFix</span> <span class="id" title="var">mft</span> <span class="id" title="var">n</span> =&gt; <span class="id" title="var">mmft</span>&lt;-(<span class="id" title="var">map_monad</span> (<span class="id" title="var">map_def_monad</span> (<span class="id" title="var">lowerRelIndex</span> <span class="id" title="var">minn</span> <span class="id" title="var">tv</span>) (<span class="id" title="var">lowerRelIndex</span> (<span class="id" title="var">S</span> <span class="id" title="var">minn</span>) <span class="id" title="var">tv</span>)) <span class="id" title="var">mft</span>);;<span class="id" title="var">ret</span> (<span class="id" title="var">tFix</span> <span class="id" title="var">mmft</span> <span class="id" title="var">n</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">tCoFix</span> <span class="id" title="var">mft</span> <span class="id" title="var">n</span> =&gt; <span class="id" title="var">mmft</span>&lt;-(<span class="id" title="var">map_monad</span> (<span class="id" title="var">map_def_monad</span> (<span class="id" title="var">lowerRelIndex</span> <span class="id" title="var">minn</span> <span class="id" title="var">tv</span>) (<span class="id" title="var">lowerRelIndex</span> (<span class="id" title="var">S</span> <span class="id" title="var">minn</span>) <span class="id" title="var">tv</span>)) <span class="id" title="var">mft</span>);;<span class="id" title="var">ret</span> (<span class="id" title="var">tCoFix</span> <span class="id" title="var">mmft</span> <span class="id" title="var">n</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">MetaCoqUtils</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">AbstractReflectionDefinitions</span>.<br/>
</div>

<div class="doc">
<a id="lab5"></a><h2 class="section">AbstractReflectionDefinitions</h2>

         Here, we define basic terms and types used when reifying  Type of term reification helper, which is given to extension points / base connective reifier.
      The arguments are:
<ul class="doclist">
<li> tct:Ast.term -- the current instance of the tarski_reflector, quoted

</li>
<li> t:Ast.term -- the actual term to be reified

</li>
<li> envTerm:Ast.term -- the env we are reifying into, quoted

</li>
<li> env: -- a helper, which gives the env index for Coq terms

</li>
<li> returning a pair of the reified term and a proof that it is correct, both quoted 
</li>
</ul>

</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">helperTermReifierType</span> := (<span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">Ast.term</span> -&gt; (<span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">FailureMonad</span> <span class="id" title="var">nat</span>) -&gt; <span class="id" title="var">FailureMonad</span> (<span class="id" title="var">prod</span> <span class="id" title="var">Ast.term</span> <span class="id" title="var">Ast.term</span>)).<br/>
</div>

<div class="doc">
The same, but used during the env constructing phase. The only arg is the term itself 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">helperTermVarsType</span> := (<span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">FailureMonad</span> (<span class="id" title="var">list</span> <span class="id" title="var">Ast.term</span>)).<br/>
</div>

<div class="doc">
Similar, but this helper is used to reify terms, not forms. Args:
<ul class="doclist">
<li> tct -- as above

</li>
<li> frees:nat -- when reifying a nary predicate, this is n.

</li>
<li> t:Ast.term -- the actual term/form to be reified

</li>
<li> envTerm -- as above

</li>
<li> env -- as above

</li>
<li> returning again a apair of reified term and proof 
</li>
</ul>

</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">helperFormReifierType</span> := (<span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">nat</span> -&gt; <span class="id" title="var">Ast.term</span> -&gt; (<span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">FailureMonad</span> <span class="id" title="var">nat</span>) -&gt; <span class="id" title="var">FailureMonad</span> (<span class="id" title="var">prod</span> <span class="id" title="var">Ast.term</span> <span class="id" title="var">Ast.term</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">helperFormVarsType</span> := (<span class="id" title="var">Ast.term</span>-&gt;<span class="id" title="var">nat</span>-&gt;<span class="id" title="var">FailureMonad</span> (<span class="id" title="var">list</span> <span class="id" title="var">Ast.term</span>)).<br/>
</div>

<div class="doc">
A base connective is an inductive in Coq.Init.Logic, like and. They are common and have their own subsystem. Arguments:
<ul class="doclist">
<li> tct -- as above

</li>
<li> lst:list Ast.term -- for e.g. (and X Y), this list contains <span class="inlinecode"><span class="id" title="var">X</span>;<span class="id" title="var">Y</span></span>.

</li>
<li> fuel:nat -- fuel (when 0, we stop)

</li>
<li> envTerm

</li>
<li> env

</li>
<li> a helper to recursively reify forms

</li>
<li> a helper to recursively reify terms

</li>
<li> return again a a pair of term and proof 
</li>
</ul>

</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">baseConnectiveReifier</span> := <span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">list</span> <span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">nat</span> -&gt; <span class="id" title="var">Ast.term</span> -&gt; (<span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">FailureMonad</span> <span class="id" title="var">nat</span>) -&gt; <span class="id" title="var">helperFormReifierType</span> -&gt; <span class="id" title="var">helperTermReifierType</span> -&gt; <span class="id" title="var">FailureMonad</span> (<span class="id" title="var">prod</span> <span class="id" title="var">Ast.term</span> <span class="id" title="var">Ast.term</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">baseConnectiveVars</span> := <span class="id" title="var">list</span> <span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">nat</span> -&gt; <span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">helperFormVarsType</span> -&gt; <span class="id" title="var">helperTermVarsType</span> -&gt; <span class="id" title="var">FailureMonad</span> (<span class="id" title="var">list</span> <span class="id" title="var">Ast.term</span>).<br/>
</div>

<div class="doc">
Extension point for term reification. Args are:
<ul class="doclist">
<li> tct:Ast.term

</li>
<li> fuel:nat (also for var finder)

</li>
<li> t:term (also for var finder) -- the actual term

</li>
<li> envTerm

</li>
<li> env

</li>
<li> recursion helper (also for var finder)

</li>
<li> returning the usual 
</li>
</ul>

</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">termFinderVars</span> := <span class="id" title="var">nat</span> -&gt; <span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">helperTermVarsType</span> -&gt; <span class="id" title="var">FailureMonad</span> (<span class="id" title="var">list</span> <span class="id" title="var">Ast.term</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">termFinderReifier</span> := <span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">nat</span> -&gt; <span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">Ast.term</span> -&gt; (<span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">FailureMonad</span> <span class="id" title="var">nat</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt; <span class="id" title="var">helperTermReifierType</span> -&gt; <span class="id" title="var">FailureMonad</span> (<span class="id" title="var">prod</span> <span class="id" title="var">Ast.term</span> <span class="id" title="var">Ast.term</span>).<br/>
</div>

<div class="doc">
Extension point for form reification. Args are:
<ul class="doclist">
<li> tct:Ast.term

</li>
<li> fuel:nat (also for var finder)

</li>
<li> t:term (also for var finder) -- the actual term

</li>
<li> frees

</li>
<li> envTerm

</li>
<li> env

</li>
<li> recursion helper for forms (also for var finder)

</li>
<li> recursion helper for terms (also for var finder)

</li>
<li> returning the usual 
</li>
</ul>

</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">propFinderVars</span> := <span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">nat</span> -&gt; <span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">nat</span> -&gt; <span class="id" title="var">helperFormVarsType</span> -&gt; <span class="id" title="var">helperTermVarsType</span> -&gt; (<span class="id" title="var">FailureMonad</span> (<span class="id" title="var">list</span> <span class="id" title="var">Ast.term</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">propFinderReifier</span> := <span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">nat</span> -&gt; <span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">nat</span> -&gt; <span class="id" title="var">Ast.term</span> -&gt; (<span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">FailureMonad</span> <span class="id" title="var">nat</span>) -&gt; <span class="id" title="var">helperFormReifierType</span> -&gt; <span class="id" title="var">helperTermReifierType</span> -&gt; <span class="id" title="var">FailureMonad</span> (<span class="id" title="var">prod</span> <span class="id" title="var">Ast.term</span> <span class="id" title="var">Ast.term</span>).<br/>

<br/>
</div>

<div class="doc">
When running in no proof mode, extension points still expect proofs. We give this dummy term. If the extension point only uses this to build further proofs, the whole term is discarded in the end 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">noProofDummy</span> := <span class="id" title="var">tVar</span> "NoProofGivenBecauseWeAreInNoProofMode".<br/>
</div>

<div class="doc">
An instance of this class is required for the reifier to work. From it the basic reification building blocks are derived 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Class</span> <span class="id" title="var">tarski_reflector</span> := {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fs</span> : <span class="id" title="var">funcs_signature</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ps</span> : <span class="id" title="var">preds_signature</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">D</span>  : <span class="id" title="keyword">Type</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">I</span>  : @<span class="id" title="var">interp</span> <span class="id" title="var">fs</span> <span class="id" title="var">ps</span> <span class="id" title="var">D</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">emptyEnv</span> : <span class="id" title="var">nat</span> -&gt; <span class="id" title="var">D</span>;  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">isD</span> : <span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">bool</span>;  <br/>
&nbsp;&nbsp;}.<br/>
</div>

<div class="doc">
Extension point to extend the libary to more syntactic constructs 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Class</span> <span class="id" title="var">tarski_reflector_extensions</span> (<span class="id" title="var">t</span>:<span class="id" title="var">tarski_reflector</span>) := {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;</div>

<div class="doc">
for reifying instances of inductive types Coq.Init.Logic.* applied to arguments. Mostly used for reifying eq 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">baseLogicConnHelper</span> : <span class="id" title="var">option</span> (<span class="id" title="var">string</span> -&gt; <span class="id" title="var">baseConnectiveReifier</span>); <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">baseLogicVarHelper</span> : <span class="id" title="var">option</span> (<span class="id" title="var">string</span> -&gt; <span class="id" title="var">baseConnectiveVars</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;</div>

<div class="doc">
for reifying all terms that we fail to reify 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">termReifierVarHelper</span> : <span class="id" title="var">option</span> <span class="id" title="var">termFinderVars</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">termReifierReifyHelper</span> : <span class="id" title="var">option</span> <span class="id" title="var">termFinderReifier</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;</div>

<div class="doc">
for reifying all forms that we fail to reify 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">formReifierVarHelper</span> : <span class="id" title="var">option</span> <span class="id" title="var">propFinderVars</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">formReifierReifyHelper</span> : <span class="id" title="var">option</span> <span class="id" title="var">propFinderReifier</span><br/>
&nbsp;&nbsp;}.<br/>
</div>

<div class="doc">
Used if no instance of the above extension class can be found 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">defaultExtensions</span> <span class="id" title="var">tr</span> : <span class="id" title="var">tarski_reflector_extensions</span> <span class="id" title="var">tr</span> := <span class="id" title="var">Build_tarski_reflector_extensions</span> <span class="id" title="var">tr</span> <span class="id" title="var">None</span> <span class="id" title="var">None</span> <span class="id" title="var">None</span> <span class="id" title="var">None</span> <span class="id" title="var">None</span> <span class="id" title="var">None</span>.<br/>
</div>

<div class="doc">
Useful builder to build the main tarski_reflector class 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">buildDefaultTarski</span> {<span class="id" title="var">fs</span>:<span class="id" title="var">funcs_signature</span>} {<span class="id" title="var">ps</span>:<span class="id" title="var">preds_signature</span>} {<span class="id" title="var">D</span>:<span class="id" title="keyword">Type</span>} {<span class="id" title="var">I</span>:@<span class="id" title="var">interp</span> <span class="id" title="var">fs</span> <span class="id" title="var">ps</span> <span class="id" title="var">D</span>} (<span class="id" title="var">point</span>:<span class="id" title="var">D</span>) (<span class="id" title="var">isD</span>:<span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">bool</span>) := <span class="id" title="var">Build_tarski_reflector</span> <span class="id" title="var">fs</span> <span class="id" title="var">ps</span> <span class="id" title="var">D</span> <span class="id" title="var">I</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">n</span>:<span class="id" title="var">nat</span> =&gt; <span class="id" title="var">point</span>) <span class="id" title="var">isD</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<span class="id" title="var">tr</span> : <span class="id" title="var">tarski_reflector</span>}.<br/>
</div>

<div class="doc">
These types are used to define representability. A n-ary formula is representable if there is a syntactic formula and an environment that you can plug the relevant values into that is equivalent 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">naryProp</span> (<span class="id" title="var">n</span>:<span class="id" title="var">nat</span>) : <span class="id" title="keyword">Type</span> := <span class="id" title="keyword">match</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span> 0 =&gt; <span class="id" title="keyword">Prop</span> | <span class="id" title="var">S</span> <span class="id" title="var">nn</span> =&gt; <span class="id" title="var">D</span> -&gt; <span class="id" title="var">naryProp</span> <span class="id" title="var">nn</span> <span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">representsP</span> {<span class="id" title="var">n</span>:<span class="id" title="var">nat</span>} <span class="id" title="var">phi</span> <span class="id" title="var">rho</span> : (<span class="id" title="keyword">forall</span> (<span class="id" title="var">P</span>:<span class="id" title="var">naryProp</span> <span class="id" title="var">n</span>), <span class="id" title="keyword">Prop</span>) := <span class="id" title="keyword">match</span> <span class="id" title="var">n</span> <span class="id" title="keyword">return</span> (<span class="id" title="keyword">forall</span> (<span class="id" title="var">P</span>:<span class="id" title="var">naryProp</span> <span class="id" title="var">n</span>), <span class="id" title="keyword">Prop</span>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0  =&gt; (<span class="id" title="keyword">fun</span> (<span class="id" title="var">P</span>:<span class="id" title="keyword">Prop</span>) =&gt; <span class="id" title="var">P</span> &lt;-&gt; @<span class="id" title="var">sat</span> <span class="id" title="var">fs</span> <span class="id" title="var">ps</span> <span class="id" title="var">D</span> <span class="id" title="var">I</span> <span class="id" title="var">rho</span> <span class="id" title="var">phi</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">n</span> =&gt; (<span class="id" title="keyword">fun</span> (<span class="id" title="var">P</span>:<span class="id" title="var">D</span> -&gt; <span class="id" title="var">naryProp</span> <span class="id" title="var">n</span>) =&gt; <span class="id" title="keyword">forall</span> <span class="id" title="var">d</span>, @<span class="id" title="var">representsP</span> <span class="id" title="var">n</span> <span class="id" title="var">phi</span> (<span class="id" title="var">d</span>.:<span class="id" title="var">rho</span>) (<span class="id" title="var">P</span> <span class="id" title="var">d</span>)) <span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">representableP</span> (<span class="id" title="var">n</span>:<span class="id" title="var">nat</span>) (<span class="id" title="var">P</span> : <span class="id" title="var">naryProp</span> <span class="id" title="var">n</span>) := <span class="id" title="tactic">exists</span> <span class="id" title="var">phi</span> <span class="id" title="var">rho</span>, <span class="id" title="var">representsP</span> <span class="id" title="var">phi</span> <span class="id" title="var">rho</span> <span class="id" title="var">P</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">representsF</span> (<span class="id" title="var">d</span>:<span class="id" title="var">D</span>) <span class="id" title="var">trm</span> <span class="id" title="var">rho</span> := @<span class="id" title="tactic">eval</span> <span class="id" title="var">fs</span> <span class="id" title="var">ps</span> <span class="id" title="var">D</span> <span class="id" title="var">I</span> <span class="id" title="var">rho</span> <span class="id" title="var">trm</span> = <span class="id" title="var">d</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">representableF</span> (<span class="id" title="var">d</span>:<span class="id" title="var">D</span>) := <span class="id" title="tactic">exists</span> <span class="id" title="var">trm</span> <span class="id" title="var">rho</span>, <span class="id" title="var">representsF</span> <span class="id" title="var">d</span> <span class="id" title="var">trm</span> <span class="id" title="var">rho</span>.<br/>

<br/>
</div>

<div class="doc">
Functions that allow us to construct syntactic connective applications without building vectors in MetaCoq 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">naryGFunc</span> (<span class="id" title="var">n</span>:<span class="id" title="var">nat</span>) (<span class="id" title="var">A</span> <span class="id" title="var">R</span> : <span class="id" title="keyword">Type</span>) := <span class="id" title="keyword">match</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span> 0 =&gt; <span class="id" title="var">R</span> | <span class="id" title="var">S</span> <span class="id" title="var">n</span> =&gt; <span class="id" title="var">A</span> -&gt; @<span class="id" title="var">naryGFunc</span> <span class="id" title="var">n</span> <span class="id" title="var">A</span> <span class="id" title="var">R</span> <span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">takeMultiple</span> {<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>} (<span class="id" title="var">X</span> <span class="id" title="var">Y</span>:<span class="id" title="keyword">Type</span>)  : (<span class="id" title="var">Vector.t</span> <span class="id" title="var">X</span> <span class="id" title="var">n</span> -&gt; <span class="id" title="var">Y</span>) -&gt; @<span class="id" title="var">naryGFunc</span> <span class="id" title="var">n</span> <span class="id" title="var">X</span> <span class="id" title="var">Y</span> := <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">n</span> <span class="id" title="keyword">as</span> <span class="id" title="var">nn</span> <span class="id" title="keyword">return</span> (<span class="id" title="var">Vector.t</span> <span class="id" title="var">X</span> <span class="id" title="var">nn</span> -&gt; <span class="id" title="var">Y</span>) -&gt; @<span class="id" title="var">naryGFunc</span> <span class="id" title="var">nn</span> <span class="id" title="var">X</span> <span class="id" title="var">Y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">with</span> 0 =&gt; <span class="id" title="keyword">fun</span> <span class="id" title="var">R</span> =&gt; <span class="id" title="var">R</span> (<span class="id" title="var">Vector.nil</span> <span class="id" title="var">X</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">n</span> =&gt; <span class="id" title="keyword">fun</span> <span class="id" title="var">R</span> <span class="id" title="var">v</span> =&gt; @<span class="id" title="var">takeMultiple</span> <span class="id" title="var">n</span> <span class="id" title="var">X</span> <span class="id" title="var">Y</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">vr</span> =&gt; <span class="id" title="var">R</span> (<span class="id" title="var">Vector.cons</span> <span class="id" title="var">X</span> <span class="id" title="var">v</span> <span class="id" title="var">n</span> <span class="id" title="var">vr</span>)) <span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">constructTerm</span> (<span class="id" title="var">k</span>:@<span class="id" title="var">syms</span> (@<span class="id" title="var">fs</span> <span class="id" title="var">tr</span>)) := @<span class="id" title="var">takeMultiple</span> (<span class="id" title="var">ar_syms</span> <span class="id" title="var">k</span>) <span class="id" title="var">term</span> <span class="id" title="var">term</span> (<span class="id" title="var">func</span> <span class="id" title="var">k</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">constructForm</span> (<span class="id" title="var">k</span>:(@<span class="id" title="var">preds</span> (@<span class="id" title="var">ps</span> <span class="id" title="var">tr</span>))) := @<span class="id" title="var">takeMultiple</span> (@<span class="id" title="var">ar_preds</span> (@<span class="id" title="var">ps</span> <span class="id" title="var">tr</span>) <span class="id" title="var">k</span>) (@<span class="id" title="var">term</span> (@<span class="id" title="var">fs</span> <span class="id" title="var">tr</span>)) <span class="id" title="var">form</span> (<span class="id" title="var">atom</span> <span class="id" title="var">k</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">nary3GFunc</span> (<span class="id" title="var">n</span>:<span class="id" title="var">nat</span>) (<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">A'</span> <span class="id" title="var">B'</span>:<span class="id" title="keyword">Type</span>) (<span class="id" title="var">C</span>:<span class="id" title="var">A</span> -&gt; <span class="id" title="var">B</span> -&gt; <span class="id" title="keyword">Type</span>) (<span class="id" title="var">C'</span>:<span class="id" title="var">A'</span>-&gt;<span class="id" title="var">B'</span>-&gt;<span class="id" title="keyword">Type</span>) : (<span class="id" title="var">Vector.t</span> <span class="id" title="var">A</span> <span class="id" title="var">n</span> -&gt; <span class="id" title="var">A'</span>) -&gt; (<span class="id" title="var">Vector.t</span> <span class="id" title="var">B</span> <span class="id" title="var">n</span> -&gt; <span class="id" title="var">B'</span>) -&gt; <span class="id" title="keyword">Type</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="keyword">match</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span> 0 =&gt; <span class="id" title="keyword">fun</span> <span class="id" title="var">mA</span> <span class="id" title="var">mB</span> =&gt; <span class="id" title="var">C'</span> (<span class="id" title="var">mA</span> (<span class="id" title="var">Vector.nil</span> <span class="id" title="var">A</span>)) (<span class="id" title="var">mB</span> (<span class="id" title="var">Vector.nil</span> <span class="id" title="var">B</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">n</span> =&gt; <span class="id" title="keyword">fun</span> <span class="id" title="var">mA</span> <span class="id" title="var">mB</span> =&gt; <span class="id" title="keyword">forall</span> (<span class="id" title="var">a</span>:<span class="id" title="var">A</span>) (<span class="id" title="var">b</span>:<span class="id" title="var">B</span>), <span class="id" title="var">C</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> -&gt; @<span class="id" title="var">nary3GFunc</span> <span class="id" title="var">n</span> <span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">A'</span> <span class="id" title="var">B'</span> <span class="id" title="var">C</span> <span class="id" title="var">C'</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">v</span> =&gt; <span class="id" title="var">mA</span> (<span class="id" title="var">Vector.cons</span> <span class="id" title="var">A</span> <span class="id" title="var">a</span> <span class="id" title="var">n</span> <span class="id" title="var">v</span>)) (<span class="id" title="keyword">fun</span> <span class="id" title="var">v</span> =&gt; <span class="id" title="var">mB</span> (<span class="id" title="var">Vector.cons</span> <span class="id" title="var">B</span> <span class="id" title="var">b</span> <span class="id" title="var">n</span> <span class="id" title="var">v</span>)) <span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">mergeTermBase</span> (<span class="id" title="var">c</span>:@<span class="id" title="var">syms</span> (@<span class="id" title="var">fs</span> <span class="id" title="var">tr</span>)) : <span class="id" title="keyword">Type</span> := <br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">rho</span>:<span class="id" title="var">nat</span> -&gt; <span class="id" title="var">D</span>), @<span class="id" title="var">nary3GFunc</span> (<span class="id" title="var">ar_syms</span> <span class="id" title="var">c</span>) <span class="id" title="var">term</span> <span class="id" title="var">D</span> <span class="id" title="var">term</span> <span class="id" title="var">D</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">t</span> <span class="id" title="var">d</span> =&gt; <span class="id" title="var">representsF</span> <span class="id" title="var">d</span> <span class="id" title="var">t</span> <span class="id" title="var">rho</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">t</span> <span class="id" title="var">d</span> =&gt; <span class="id" title="var">representsF</span> <span class="id" title="var">d</span> <span class="id" title="var">t</span> <span class="id" title="var">rho</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">func</span> <span class="id" title="var">c</span>) (@<span class="id" title="var">i_f</span> <span class="id" title="var">fs</span> <span class="id" title="var">ps</span> <span class="id" title="var">D</span> <span class="id" title="var">I</span> <span class="id" title="var">c</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">mergeTermProtoType</span> (<span class="id" title="var">rho</span>:<span class="id" title="var">nat</span> -&gt; <span class="id" title="var">D</span>) (<span class="id" title="var">n</span>:<span class="id" title="var">nat</span>) (<span class="id" title="var">fZ</span>:<span class="id" title="var">vec</span> <span class="id" title="var">term</span> <span class="id" title="var">n</span> -&gt; <span class="id" title="var">term</span>) (<span class="id" title="var">ifZ</span> : <span class="id" title="var">vec</span> <span class="id" title="var">D</span> <span class="id" title="var">n</span> -&gt; <span class="id" title="var">D</span>) := <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">v</span> : <span class="id" title="var">vec</span> <span class="id" title="var">term</span> <span class="id" title="var">n</span>, @<span class="id" title="tactic">eval</span> <span class="id" title="var">fs</span> <span class="id" title="var">ps</span> <span class="id" title="var">D</span> <span class="id" title="var">I</span> <span class="id" title="var">rho</span> (<span class="id" title="var">fZ</span> <span class="id" title="var">v</span>) = <span class="id" title="var">ifZ</span> (<span class="id" title="var">Vector.map</span> (@<span class="id" title="tactic">eval</span> <span class="id" title="var">fs</span> <span class="id" title="var">ps</span> <span class="id" title="var">D</span> <span class="id" title="var">I</span> <span class="id" title="var">rho</span>) <span class="id" title="var">v</span>))  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt; @<span class="id" title="var">nary3GFunc</span> <span class="id" title="var">n</span> <span class="id" title="var">term</span> <span class="id" title="var">D</span> <span class="id" title="var">term</span> <span class="id" title="var">D</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">t</span> <span class="id" title="var">d</span> =&gt; <span class="id" title="var">representsF</span> <span class="id" title="var">d</span> <span class="id" title="var">t</span> <span class="id" title="var">rho</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">t</span> <span class="id" title="var">d</span> =&gt; <span class="id" title="var">representsF</span> <span class="id" title="var">d</span> <span class="id" title="var">t</span> <span class="id" title="var">rho</span>) <span class="id" title="var">fZ</span> <span class="id" title="var">ifZ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">mergeTermProto</span> (<span class="id" title="var">rho</span>:<span class="id" title="var">nat</span> -&gt; <span class="id" title="var">D</span>) (<span class="id" title="var">n</span>:<span class="id" title="var">nat</span>) (<span class="id" title="var">fZ</span>:<span class="id" title="var">vec</span> <span class="id" title="var">term</span> <span class="id" title="var">n</span> -&gt; <span class="id" title="var">term</span>) (<span class="id" title="var">ifZ</span> : <span class="id" title="var">vec</span> <span class="id" title="var">D</span> <span class="id" title="var">n</span> -&gt; <span class="id" title="var">D</span>) : <span class="id" title="var">mergeTermProtoType</span> <span class="id" title="var">rho</span> <span class="id" title="var">n</span> <span class="id" title="var">fZ</span> <span class="id" title="var">ifZ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">n</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">n</span> <span class="id" title="var">IH</span>].<br/>
&nbsp;&nbsp;* <span class="id" title="var">cbn</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">representsF</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>. <span class="id" title="var">cbn</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;* <span class="id" title="var">cbn</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">t</span> <span class="id" title="var">d</span> <span class="id" title="var">r</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span>. <span class="id" title="var">cbn</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">v</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> (<span class="id" title="var">Vector.cons</span> <span class="id" title="var">t</span> <span class="id" title="var">v</span>)). <span class="id" title="tactic">unfold</span> <span class="id" title="var">representsF</span> <span class="id" title="tactic">in</span> <span class="id" title="var">r</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>. <span class="id" title="var">cbn</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">r</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">mergeTerm</span> (<span class="id" title="var">c</span>:<span class="id" title="var">syms</span>) : <span class="id" title="var">mergeTermBase</span> <span class="id" title="var">c</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">rho</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">mergeTermProto</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> <span class="id" title="var">v</span>. <span class="id" title="keyword">Defined</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">mergeFormBase</span> (<span class="id" title="var">c</span>:@<span class="id" title="var">preds</span> (@<span class="id" title="var">ps</span> <span class="id" title="var">tr</span>)) : <span class="id" title="keyword">Type</span> := <br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">rho</span>:<span class="id" title="var">nat</span> -&gt; <span class="id" title="var">D</span>), @<span class="id" title="var">nary3GFunc</span> (<span class="id" title="var">ar_preds</span> <span class="id" title="var">c</span>) <span class="id" title="var">term</span> <span class="id" title="var">D</span> <span class="id" title="var">form</span> (<span class="id" title="var">naryProp</span> 0) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">t</span> <span class="id" title="var">d</span> =&gt; <span class="id" title="var">representsF</span> <span class="id" title="var">d</span> <span class="id" title="var">t</span> <span class="id" title="var">rho</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">t</span> <span class="id" title="var">P</span> =&gt; <span class="id" title="var">representsP</span> <span class="id" title="var">t</span> <span class="id" title="var">rho</span> <span class="id" title="var">P</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">atom</span> <span class="id" title="var">c</span>) (@<span class="id" title="var">i_P</span> <span class="id" title="var">fs</span> <span class="id" title="var">ps</span> <span class="id" title="var">D</span> <span class="id" title="var">I</span> <span class="id" title="var">c</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">mergeFormProtoType</span> (<span class="id" title="var">rho</span>:<span class="id" title="var">nat</span> -&gt; <span class="id" title="var">D</span>) (<span class="id" title="var">n</span>:<span class="id" title="var">nat</span>) (<span class="id" title="var">fZ</span>:<span class="id" title="var">vec</span> <span class="id" title="var">term</span> <span class="id" title="var">n</span> -&gt; <span class="id" title="var">form</span>) (<span class="id" title="var">ifZ</span> : <span class="id" title="var">vec</span> <span class="id" title="var">D</span> <span class="id" title="var">n</span> -&gt; <span class="id" title="var">naryProp</span> 0) := <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">v</span> : <span class="id" title="var">vec</span> <span class="id" title="var">term</span> <span class="id" title="var">n</span>, @<span class="id" title="var">sat</span> <span class="id" title="var">fs</span> <span class="id" title="var">ps</span> <span class="id" title="var">D</span> <span class="id" title="var">I</span> <span class="id" title="var">rho</span> (<span class="id" title="var">fZ</span> <span class="id" title="var">v</span>) = <span class="id" title="var">ifZ</span> (<span class="id" title="var">Vector.map</span> (@<span class="id" title="tactic">eval</span> <span class="id" title="var">fs</span> <span class="id" title="var">ps</span> <span class="id" title="var">D</span> <span class="id" title="var">I</span> <span class="id" title="var">rho</span>) <span class="id" title="var">v</span>))  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt; @<span class="id" title="var">nary3GFunc</span> <span class="id" title="var">n</span> <span class="id" title="var">term</span> <span class="id" title="var">D</span> <span class="id" title="var">form</span> (<span class="id" title="var">naryProp</span> 0) (<span class="id" title="keyword">fun</span> <span class="id" title="var">t</span> <span class="id" title="var">d</span> =&gt; <span class="id" title="var">representsF</span> <span class="id" title="var">d</span> <span class="id" title="var">t</span> <span class="id" title="var">rho</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">t</span> <span class="id" title="var">P</span> =&gt; <span class="id" title="var">representsP</span> <span class="id" title="var">t</span> <span class="id" title="var">rho</span> <span class="id" title="var">P</span>) <span class="id" title="var">fZ</span> <span class="id" title="var">ifZ</span>.<br/>
</div>

<div class="doc">
Proof that the functions built using the above helper actually represent the syntactic construct they are supposed to represent 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">mergeFormProto</span> (<span class="id" title="var">rho</span>:<span class="id" title="var">nat</span> -&gt; <span class="id" title="var">D</span>) (<span class="id" title="var">n</span>:<span class="id" title="var">nat</span>) (<span class="id" title="var">fZ</span>:<span class="id" title="var">vec</span> <span class="id" title="var">term</span> <span class="id" title="var">n</span> -&gt; <span class="id" title="var">form</span>) (<span class="id" title="var">ifZ</span> : <span class="id" title="var">vec</span> <span class="id" title="var">D</span> <span class="id" title="var">n</span> -&gt; <span class="id" title="var">naryProp</span> 0) : <span class="id" title="var">mergeFormProtoType</span> <span class="id" title="var">rho</span> <span class="id" title="var">n</span> <span class="id" title="var">fZ</span> <span class="id" title="var">ifZ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">n</span> <span class="id" title="keyword">as</span> [|<span class="id" title="var">n</span> <span class="id" title="var">IH</span>].<br/>
&nbsp;&nbsp;* <span class="id" title="var">cbn</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">representsP</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>. <span class="id" title="var">cbn</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;* <span class="id" title="var">cbn</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">t</span> <span class="id" title="var">d</span> <span class="id" title="var">r</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span>. <span class="id" title="var">cbn</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">v</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> (<span class="id" title="var">Vector.cons</span> <span class="id" title="var">t</span> <span class="id" title="var">v</span>)). <span class="id" title="tactic">unfold</span> <span class="id" title="var">representsF</span> <span class="id" title="tactic">in</span> <span class="id" title="var">r</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>. <span class="id" title="var">cbn</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">r</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">mergeForm</span> (<span class="id" title="var">c</span>:<span class="id" title="var">preds</span>) : <span class="id" title="var">mergeFormBase</span> <span class="id" title="var">c</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">rho</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">mergeFormProto</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">intros</span> <span class="id" title="var">v</span>. <span class="id" title="keyword">Defined</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">MetaCoq</span> <span class="id" title="var">Quote</span> <span class="id" title="keyword">Definition</span> <span class="id" title="var">qConstructTerm</span> := <span class="id" title="var">constructTerm</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">MetaCoq</span> <span class="id" title="var">Quote</span> <span class="id" title="keyword">Definition</span> <span class="id" title="var">qMergeTerm</span> := <span class="id" title="var">mergeTerm</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">MetaCoq</span> <span class="id" title="var">Quote</span> <span class="id" title="keyword">Definition</span> <span class="id" title="var">qConstructForm</span> := <span class="id" title="var">constructForm</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">MetaCoq</span> <span class="id" title="var">Quote</span> <span class="id" title="keyword">Definition</span> <span class="id" title="var">qMergeForm</span> := <span class="id" title="var">mergeForm</span>.<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">AbstractReflectionDefinitions</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">TarskiMerging</span>.<br/>
</div>

<div class="doc">
**TarskiMerging
        Here we have reifiers for basic logical connectives which are part of the core Tarski semantics and thus every model.
        These are and, or, falsity, implication and both quantifiers 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<span class="id" title="var">tr</span> : <span class="id" title="var">tarski_reflector</span>}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<span class="id" title="var">te</span> : <span class="id" title="var">tarski_reflector_extensions</span> <span class="id" title="var">tr</span>}.<br/>
</div>

<div class="doc">
For each connective, we have a "merger" that takes subproof that a term is represented by its reification, and proof that the larger term also represents its subterm.
      For falsity, there are not subterms, so we just prove that fal represents False, which is trivial 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">mergeFalse</span> (<span class="id" title="var">rho</span>:<span class="id" title="var">nat</span> -&gt; <span class="id" title="var">D</span>) : @<span class="id" title="var">representsP</span> <span class="id" title="var">tr</span> 0 <span class="id" title="var">fal</span> <span class="id" title="var">rho</span> <span class="id" title="var">False</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="var">easy</span>. <span class="id" title="keyword">Defined</span>.<br/>
</div>

<div class="doc">
We then define a quoted version of the above proof which is later used to build subterms 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="var">MetaCoq</span> <span class="id" title="var">Quote</span> <span class="id" title="keyword">Definition</span> <span class="id" title="var">qMergeFalse</span> := @<span class="id" title="var">mergeFalse</span>.<br/>
</div>

<div class="doc">
We also define a form merger, which is a function that takes the reified subterms (not the proofs) and builds the reified term. For False, this is just a term that represents false (here given without syntact sugar) 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">mFalse</span> := (@<span class="id" title="var">fal</span> <span class="id" title="var">fs</span> <span class="id" title="var">ps</span> <span class="id" title="var">full_operators</span>).<br/>
</div>

<div class="doc">
Finally we define a quoted form merger which will then later be applied to the subforms 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="var">MetaCoq</span> <span class="id" title="var">Quote</span> <span class="id" title="keyword">Definition</span> <span class="id" title="var">qMergeFormFalse</span> := @<span class="id" title="var">mFalse</span>.<br/>

<br/>
</div>

<div class="doc">
The same development for And. Note that this time we have subproofs. Our function arguments follow this pattern:
<ul class="doclist">
<li> tr_quoted - quoted tarski_reflector (not visible in the arguments, but it's a context variable. Note that since the functions don't acually use te, it does not become part of the arguments outside the section

</li>
<li> environment

</li>
<li> coq subterms that are to be reified

</li>
<li> reified subterms

</li>
<li> proof that the reified subterms are actually the reifications 
</li>
</ul>

</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">mergeAnd</span> (<span class="id" title="var">rho</span>:<span class="id" title="var">nat</span> -&gt; <span class="id" title="var">D</span>) (<span class="id" title="var">P</span> <span class="id" title="var">Q</span> : <span class="id" title="var">naryProp</span> 0) (<span class="id" title="var">fP</span> <span class="id" title="var">fQ</span> : <span class="id" title="var">form</span>) : <span class="id" title="var">representsP</span> <span class="id" title="var">fP</span> <span class="id" title="var">rho</span> <span class="id" title="var">P</span> -&gt; <span class="id" title="var">representsP</span> <span class="id" title="var">fQ</span> <span class="id" title="var">rho</span> <span class="id" title="var">Q</span> -&gt; @<span class="id" title="var">representsP</span> <span class="id" title="var">tr</span> 0 (<span class="id" title="var">fP</span><span class="id" title="var">fQ</span>) <span class="id" title="var">rho</span> (<span class="id" title="var">P</span> /\ <span class="id" title="var">Q</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [<span class="id" title="var">pPl</span> <span class="id" title="var">pPr</span>] [<span class="id" title="var">pQl</span> <span class="id" title="var">pQr</span>]. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;* <span class="id" title="tactic">intros</span> [<span class="id" title="var">pP</span> <span class="id" title="var">pQ</span>]. <span class="id" title="tactic">split</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">pPl</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">pQl</span>.<br/>
&nbsp;&nbsp;* <span class="id" title="tactic">intros</span> [<span class="id" title="var">pP</span> <span class="id" title="var">pQ</span>]. <span class="id" title="tactic">split</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">pPr</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">pQr</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">MetaCoq</span> <span class="id" title="var">Quote</span> <span class="id" title="keyword">Definition</span> <span class="id" title="var">qMergeAnd</span> := @<span class="id" title="var">mergeAnd</span>.<br/>
</div>

<div class="doc">
This is the form merger for and. It is unfolded syntactic sugar, once one adds the arguments x and y, this will read x  y. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">mAnd</span> := (@<span class="id" title="var">bin</span> <span class="id" title="var">fs</span> <span class="id" title="var">ps</span> <span class="id" title="var">full_operators</span> <span class="id" title="var">Conj</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">MetaCoq</span> <span class="id" title="var">Quote</span> <span class="id" title="keyword">Definition</span> <span class="id" title="var">qMergeFormAnd</span> := @<span class="id" title="var">mAnd</span>.<br/>

<br/>
</div>

<div class="doc">
The same development for or
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">mergeOr</span> (<span class="id" title="var">rho</span>:<span class="id" title="var">nat</span> -&gt; <span class="id" title="var">D</span>) (<span class="id" title="var">P</span> <span class="id" title="var">Q</span> : <span class="id" title="var">naryProp</span> 0) (<span class="id" title="var">fP</span> <span class="id" title="var">fQ</span> : <span class="id" title="var">form</span>) : <span class="id" title="var">representsP</span> <span class="id" title="var">fP</span> <span class="id" title="var">rho</span> <span class="id" title="var">P</span> -&gt; <span class="id" title="var">representsP</span> <span class="id" title="var">fQ</span> <span class="id" title="var">rho</span> <span class="id" title="var">Q</span> -&gt; @<span class="id" title="var">representsP</span> <span class="id" title="var">tr</span> 0 (<span class="id" title="var">fP</span><span class="id" title="var">fQ</span>) <span class="id" title="var">rho</span> (<span class="id" title="var">P</span> \/ <span class="id" title="var">Q</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> [<span class="id" title="var">pPl</span> <span class="id" title="var">pPr</span>] [<span class="id" title="var">pQl</span> <span class="id" title="var">pQr</span>]. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;* <span class="id" title="tactic">intros</span> [<span class="id" title="var">pP</span>|<span class="id" title="var">pQ</span>]. <span class="id" title="tactic">left</span>; <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">pPl</span>. <span class="id" title="tactic">right</span>; <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">pQl</span>.<br/>
&nbsp;&nbsp;* <span class="id" title="tactic">intros</span> [<span class="id" title="var">pP</span>|<span class="id" title="var">pQ</span>]. <span class="id" title="tactic">left</span>; <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">pPr</span>. <span class="id" title="tactic">right</span>; <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">pQr</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">MetaCoq</span> <span class="id" title="var">Quote</span> <span class="id" title="keyword">Definition</span> <span class="id" title="var">qMergeOr</span> := @<span class="id" title="var">mergeOr</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">mOr</span> := (@<span class="id" title="var">bin</span> <span class="id" title="var">fs</span> <span class="id" title="var">ps</span> <span class="id" title="var">full_operators</span> <span class="id" title="var">Disj</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">MetaCoq</span> <span class="id" title="var">Quote</span> <span class="id" title="keyword">Definition</span> <span class="id" title="var">qMergeFormOr</span> := @<span class="id" title="var">mOr</span>.<br/>

<br/>
</div>

<div class="doc">
The same development for existential quantifiaction. Note that the P argument is a 1-ary predicate.
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">mergeExists</span> (<span class="id" title="var">rho</span>:<span class="id" title="var">nat</span> -&gt; <span class="id" title="var">D</span>) (<span class="id" title="var">P</span>:<span class="id" title="var">naryProp</span> 1) (<span class="id" title="var">fP</span>:<span class="id" title="var">form</span>) : <span class="id" title="var">representsP</span> <span class="id" title="var">fP</span> <span class="id" title="var">rho</span> <span class="id" title="var">P</span> -&gt; @<span class="id" title="var">representsP</span> <span class="id" title="var">tr</span> 0 ( <span class="id" title="var">fP</span>) <span class="id" title="var">rho</span> (<span class="id" title="tactic">exists</span> <span class="id" title="var">q</span>:<span class="id" title="var">D</span>, <span class="id" title="var">P</span> <span class="id" title="var">q</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">pR</span>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;* <span class="id" title="tactic">intros</span> [<span class="id" title="var">q</span> <span class="id" title="var">Pq</span>]. <span class="id" title="tactic">exists</span> <span class="id" title="var">q</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">pR</span> <span class="id" title="var">q</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">pRl</span> <span class="id" title="var">pRr</span>]. <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">pRl</span>.<br/>
&nbsp;&nbsp;* <span class="id" title="tactic">intros</span> [<span class="id" title="var">q</span> <span class="id" title="var">Pq</span>]. <span class="id" title="tactic">exists</span> <span class="id" title="var">q</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">pR</span> <span class="id" title="var">q</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">pRl</span> <span class="id" title="var">pRr</span>]. <span class="id" title="var">now</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">pRr</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">MetaCoq</span> <span class="id" title="var">Quote</span> <span class="id" title="keyword">Definition</span> <span class="id" title="var">qMergeExists</span> := @<span class="id" title="var">mergeExists</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">mExists</span> := (@<span class="id" title="var">quant</span> <span class="id" title="var">fs</span> <span class="id" title="var">ps</span> <span class="id" title="var">full_operators</span> <span class="id" title="var">Ex</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">MetaCoq</span> <span class="id" title="var">Quote</span> <span class="id" title="keyword">Definition</span> <span class="id" title="var">qMergeFormExists</span> := @<span class="id" title="var">mExists</span>.<br/>

<br/>
</div>

<div class="doc">
The same development for implication. Note that implication is handled in the main reification logic since P -&gt; Q is just syntactic sugar for (forall _:P, Q)
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">mergeImpl</span> (<span class="id" title="var">rho</span>:<span class="id" title="var">nat</span> -&gt; <span class="id" title="var">D</span>) (<span class="id" title="var">P</span> <span class="id" title="var">Q</span> : <span class="id" title="var">naryProp</span> 0) (<span class="id" title="var">fP</span> <span class="id" title="var">fQ</span> : <span class="id" title="var">form</span>) : <span class="id" title="var">representsP</span> <span class="id" title="var">fP</span> <span class="id" title="var">rho</span> <span class="id" title="var">P</span> -&gt; <span class="id" title="var">representsP</span> <span class="id" title="var">fQ</span> <span class="id" title="var">rho</span> <span class="id" title="var">Q</span> -&gt; @<span class="id" title="var">representsP</span> <span class="id" title="var">tr</span> 0 (<span class="id" title="var">fP</span> --&gt; <span class="id" title="var">fQ</span>) <span class="id" title="var">rho</span> (<span class="id" title="var">P</span> -&gt; <span class="id" title="var">Q</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">HP</span> <span class="id" title="var">HQ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">HP</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">pPl</span> <span class="id" title="var">pPr</span>]. <span class="id" title="tactic">destruct</span> <span class="id" title="var">HQ</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">pQl</span> <span class="id" title="var">pQr</span>]. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;* <span class="id" title="tactic">intros</span> <span class="id" title="var">PQ</span> <span class="id" title="var">pP</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">pQl</span>, <span class="id" title="var">PQ</span>, <span class="id" title="var">pPr</span>, <span class="id" title="var">pP</span>.<br/>
&nbsp;&nbsp;* <span class="id" title="var">cbn</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">pPQ</span> <span class="id" title="var">pP</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">pQr</span>, <span class="id" title="var">pPQ</span>, <span class="id" title="var">pPl</span>, <span class="id" title="var">pP</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">MetaCoq</span> <span class="id" title="var">Quote</span> <span class="id" title="keyword">Definition</span> <span class="id" title="var">qMergeImpl</span> := @<span class="id" title="var">mergeImpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">mImpl</span> := (@<span class="id" title="var">bin</span> <span class="id" title="var">fs</span> <span class="id" title="var">ps</span> <span class="id" title="var">full_operators</span> <span class="id" title="var">Impl</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">MetaCoq</span> <span class="id" title="var">Quote</span> <span class="id" title="keyword">Definition</span> <span class="id" title="var">qMergeFormImpl</span> := @<span class="id" title="var">mImpl</span>.<br/>
</div>

<div class="doc">
The same development for forall. Since forall-quantification in Coq is a part of the proper syntax (product types), this will again be handled by the main reification
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">mergeForall</span> (<span class="id" title="var">rho</span>:<span class="id" title="var">nat</span> -&gt; <span class="id" title="var">D</span>) (<span class="id" title="var">Q</span>:<span class="id" title="var">naryProp</span> 1) (<span class="id" title="var">phi</span>:<span class="id" title="var">form</span>) : <span class="id" title="var">representsP</span> <span class="id" title="var">phi</span> <span class="id" title="var">rho</span> <span class="id" title="var">Q</span> -&gt; @<span class="id" title="var">representsP</span> <span class="id" title="var">tr</span> 0 ( <span class="id" title="var">phi</span>) <span class="id" title="var">rho</span> (<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>:<span class="id" title="var">D</span>, <span class="id" title="var">Q</span> <span class="id" title="var">x</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>. <span class="id" title="var">cbn</span>. <span class="id" title="tactic">split</span>;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">HH</span> <span class="id" title="var">d</span>; <span class="id" title="tactic">specialize</span> (<span class="id" title="var">HH</span> <span class="id" title="var">d</span>); <span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> <span class="id" title="var">d</span>); <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>, <span class="id" title="var">HH</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Defined</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">MetaCoq</span> <span class="id" title="var">Quote</span> <span class="id" title="keyword">Definition</span> <span class="id" title="var">qMergeForall</span> := @<span class="id" title="var">mergeForall</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">mForall</span> := (@<span class="id" title="var">quant</span> <span class="id" title="var">fs</span> <span class="id" title="var">ps</span> <span class="id" title="var">full_operators</span> <span class="id" title="keyword">All</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">MetaCoq</span> <span class="id" title="var">Quote</span> <span class="id" title="keyword">Definition</span> <span class="id" title="var">qMergeFormForall</span> := @<span class="id" title="var">mForall</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">mergeIff</span> (<span class="id" title="var">rho</span>:<span class="id" title="var">nat</span> -&gt; <span class="id" title="var">D</span>) (<span class="id" title="var">P</span> <span class="id" title="var">Q</span> : <span class="id" title="var">naryProp</span> 0) (<span class="id" title="var">fP</span> <span class="id" title="var">fQ</span> : <span class="id" title="var">form</span>) : <span class="id" title="var">representsP</span> <span class="id" title="var">fP</span> <span class="id" title="var">rho</span> <span class="id" title="var">P</span> -&gt; <span class="id" title="var">representsP</span> <span class="id" title="var">fQ</span> <span class="id" title="var">rho</span> <span class="id" title="var">Q</span> -&gt; @<span class="id" title="var">representsP</span> <span class="id" title="var">_</span> 0 ((<span class="id" title="var">fP</span>--&gt;<span class="id" title="var">fQ</span>)(<span class="id" title="var">fQ</span>--&gt;<span class="id" title="var">fP</span>)) <span class="id" title="var">rho</span> (<span class="id" title="var">P</span> &lt;-&gt; <span class="id" title="var">Q</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H1</span> <span class="id" title="var">H2</span>. <span class="id" title="var">cbn</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>,<span class="id" title="var">H2</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H2</span>, <span class="id" title="var">H1</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Defined</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">mIff</span> := (<span class="id" title="keyword">fun</span> <span class="id" title="var">fP</span> <span class="id" title="var">fQ</span> : <span class="id" title="var">form</span> =&gt; <span class="id" title="var">mAnd</span> (<span class="id" title="var">mImpl</span> <span class="id" title="var">fP</span> <span class="id" title="var">fQ</span>) (<span class="id" title="var">mImpl</span> <span class="id" title="var">fQ</span> <span class="id" title="var">fP</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="var">MetaCoq</span> <span class="id" title="var">Quote</span> <span class="id" title="keyword">Definition</span> <span class="id" title="var">qMergeFormIff</span> := @<span class="id" title="var">mIff</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">MetaCoq</span> <span class="id" title="var">Quote</span> <span class="id" title="keyword">Definition</span> <span class="id" title="var">qMergeIff</span> := <span class="id" title="var">mergeIff</span>.<br/>

<br/>
</div>

<div class="doc">
The same development for truth. Note that truth has no canonical representative in the tarski semantics. It is equivalent to (falsity -&gt; falsity), but not computationally equal. So using True in noProof mode would fail.
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">mergeTrue</span> (<span class="id" title="var">rho</span>:<span class="id" title="var">nat</span> -&gt; <span class="id" title="var">D</span>) : @<span class="id" title="var">representsP</span> <span class="id" title="var">_</span> 0 (<span class="id" title="var">fal</span>--&gt;<span class="id" title="var">fal</span>) <span class="id" title="var">rho</span> (<span class="id" title="var">True</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>. <span class="id" title="var">cbn</span>. <span class="id" title="tactic">tauto</span>. <span class="id" title="keyword">Defined</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">mTrue</span> := (<span class="id" title="var">mImpl</span> <span class="id" title="var">mFalse</span> <span class="id" title="var">mFalse</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">MetaCoq</span> <span class="id" title="var">Quote</span> <span class="id" title="keyword">Definition</span> <span class="id" title="var">qMergeFormTrue</span> := @<span class="id" title="var">mTrue</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">MetaCoq</span> <span class="id" title="var">Quote</span> <span class="id" title="keyword">Definition</span> <span class="id" title="var">qMergeTrue</span> := <span class="id" title="var">mergeTrue</span>.<br/>

<br/>
</div>

<div class="doc">
Notation for matching constructs like Coq.Init.Logic.and prop1 prop2 -&gt; (x:="and", l:=<span class="inlinecode"><span class="id" title="var">term1</span>,</span> <span class="inlinecode"><span class="id" title="var">term2</span></span>) 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> <span class="id" title="var">baseLogicConn</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span>:= (<span class="id" title="var">tInd</span> {| <span class="id" title="var">inductive_mind</span> := (<span class="id" title="var">MPfile</span> (["Logic"; "Init"; "Coq"]), <span class="id" title="var">x</span>); <span class="id" title="var">inductive_ind</span> := 0 |} <span class="id" title="var">l</span>).<br/>
</div>

<div class="doc">
We now define reification helpers for each of the primitives (except implication&amp;forall). These helpers recursively apply the main reification function to the subterms and assemble the resulting term/prood
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">reifyFalse</span> : <span class="id" title="var">baseConnectiveReifier</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">tct</span> <span class="id" title="var">lst</span> <span class="id" title="var">_</span> <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span> <span class="id" title="var">fPR</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">lst</span> <span class="id" title="keyword">with</span> <span class="id" title="var">nil</span> =&gt; <span class="id" title="var">ret</span> (<span class="id" title="var">tApp</span> <span class="id" title="var">qMergeFormFalse</span> ([<span class="id" title="var">tct</span>]), <span class="id" title="var">tApp</span> <span class="id" title="var">qMergeFalse</span> ([<span class="id" title="var">tct</span>;<span class="id" title="var">envTerm</span>])) | <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "False applied to terms" <span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">reifyAnd</span> : <span class="id" title="var">baseConnectiveReifier</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">tct</span> <span class="id" title="var">lst</span> <span class="id" title="var">_</span> <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span> <span class="id" title="var">fPR</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">lst</span> <span class="id" title="keyword">with</span> [<span class="id" title="var">x</span>; <span class="id" title="var">y</span>] =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xr</span> &lt;- <span class="id" title="var">fPR</span> <span class="id" title="var">x</span> 0 <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span>;;<span class="id" title="var">yr</span> &lt;- <span class="id" title="var">fPR</span> <span class="id" title="var">y</span> 0 <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span>;; <span class="id" title="keyword">let</span> '((<span class="id" title="var">xt</span>,<span class="id" title="var">xp</span>),(<span class="id" title="var">yt</span>,<span class="id" title="var">yp</span>)) := (<span class="id" title="var">xr</span>,<span class="id" title="var">yr</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ret</span> (<span class="id" title="var">tApp</span> <span class="id" title="var">qMergeFormAnd</span> ([<span class="id" title="var">tct</span>;<span class="id" title="var">xt</span>;<span class="id" title="var">yt</span>]), <span class="id" title="var">tApp</span> <span class="id" title="var">qMergeAnd</span> ([<span class="id" title="var">tct</span>;<span class="id" title="var">envTerm</span>;<span class="id" title="var">x</span>;<span class="id" title="var">y</span>;<span class="id" title="var">xt</span>;<span class="id" title="var">yt</span>;<span class="id" title="var">xp</span>;<span class="id" title="var">yp</span>])) | <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "And applied to != 2 terms" <span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">reifyOr</span>  : <span class="id" title="var">baseConnectiveReifier</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">tct</span> <span class="id" title="var">lst</span> <span class="id" title="var">_</span> <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span> <span class="id" title="var">fPR</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">lst</span> <span class="id" title="keyword">with</span> [<span class="id" title="var">x</span>; <span class="id" title="var">y</span>] =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xr</span> &lt;- <span class="id" title="var">fPR</span> <span class="id" title="var">x</span> 0 <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span>;;<span class="id" title="var">yr</span> &lt;- <span class="id" title="var">fPR</span> <span class="id" title="var">y</span> 0 <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span>;; <span class="id" title="keyword">let</span> '((<span class="id" title="var">xt</span>,<span class="id" title="var">xp</span>),(<span class="id" title="var">yt</span>,<span class="id" title="var">yp</span>)) := (<span class="id" title="var">xr</span>,<span class="id" title="var">yr</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ret</span> (<span class="id" title="var">tApp</span> <span class="id" title="var">qMergeFormOr</span> ([<span class="id" title="var">tct</span>;<span class="id" title="var">xt</span>;<span class="id" title="var">yt</span>]),<span class="id" title="var">tApp</span> <span class="id" title="var">qMergeOr</span> ([<span class="id" title="var">tct</span>;<span class="id" title="var">envTerm</span>;<span class="id" title="var">x</span>;<span class="id" title="var">y</span>;<span class="id" title="var">xt</span>;<span class="id" title="var">yt</span>;<span class="id" title="var">xp</span>;<span class="id" title="var">yp</span>])) | <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "Or applied to != 2 terms" <span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">reifyExist</span>:<span class="id" title="var">baseConnectiveReifier</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">tct</span> <span class="id" title="var">lst</span> <span class="id" title="var">_</span> <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span> <span class="id" title="var">fPR</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">lst</span> <span class="id" title="keyword">with</span> [<span class="id" title="var">_</span>; <span class="id" title="var">P</span>] =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rr</span> &lt;- <span class="id" title="var">fPR</span> <span class="id" title="var">P</span> 1 <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span>;; <span class="id" title="keyword">let</span> '(<span class="id" title="var">rt</span>,<span class="id" title="var">rp</span>) := <span class="id" title="var">rr</span> <span class="id" title="tactic">in</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ret</span> (<span class="id" title="var">tApp</span> <span class="id" title="var">qMergeFormExists</span> ([<span class="id" title="var">tct</span>;<span class="id" title="var">rt</span>]), <span class="id" title="var">tApp</span> <span class="id" title="var">qMergeExists</span> ([<span class="id" title="var">tct</span>;<span class="id" title="var">envTerm</span>;<span class="id" title="var">P</span>;<span class="id" title="var">rt</span>;<span class="id" title="var">rp</span>])) | <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "Exist applied to wrong terms" <span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">reifyIff</span> : <span class="id" title="var">baseConnectiveReifier</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">tct</span> <span class="id" title="var">lst</span> <span class="id" title="var">_</span> <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span> <span class="id" title="var">fPR</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">lst</span> <span class="id" title="keyword">with</span> [<span class="id" title="var">x</span>; <span class="id" title="var">y</span>] =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xr</span> &lt;- <span class="id" title="var">fPR</span> <span class="id" title="var">x</span> 0 <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span>;;<span class="id" title="var">yr</span> &lt;- <span class="id" title="var">fPR</span> <span class="id" title="var">y</span> 0 <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span>;; <span class="id" title="keyword">let</span> '((<span class="id" title="var">xt</span>,<span class="id" title="var">xp</span>),(<span class="id" title="var">yt</span>,<span class="id" title="var">yp</span>)) := (<span class="id" title="var">xr</span>,<span class="id" title="var">yr</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ret</span> (<span class="id" title="var">tApp</span> <span class="id" title="var">qMergeFormIff</span> ([<span class="id" title="var">tct</span>;<span class="id" title="var">xt</span>;<span class="id" title="var">yt</span>]), <span class="id" title="var">tApp</span> <span class="id" title="var">qMergeIff</span> ([<span class="id" title="var">tct</span>;<span class="id" title="var">envTerm</span>;<span class="id" title="var">x</span>;<span class="id" title="var">y</span>;<span class="id" title="var">xt</span>;<span class="id" title="var">yt</span>;<span class="id" title="var">xp</span>;<span class="id" title="var">yp</span>])) | <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "Iff applied to != 2 terms" <span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">reifyTrue</span> : <span class="id" title="var">baseConnectiveReifier</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">tct</span> <span class="id" title="var">l</span> <span class="id" title="var">fuel</span> <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span> <span class="id" title="var">fPR</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">l</span> <span class="id" title="keyword">with</span> <span class="id" title="var">nil</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ret</span> (<span class="id" title="var">tApp</span> <span class="id" title="var">qMergeFormTrue</span> ([<span class="id" title="var">tct</span>]), <span class="id" title="var">tApp</span> <span class="id" title="var">qMergeTrue</span> ([<span class="id" title="var">tct</span>;<span class="id" title="var">envTerm</span>]))| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "True applied to terms" <span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
The main handler. Given the name of the base type, call the respective helper. If nothing matches, call the extension point 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">reifyBase</span> (<span class="id" title="var">s</span>:<span class="id" title="var">string</span>): <span class="id" title="var">baseConnectiveReifier</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="keyword">match</span> <span class="id" title="var">s</span> <span class="id" title="keyword">with</span> "and" =&gt; <span class="id" title="var">reifyAnd</span> | "or" =&gt; <span class="id" title="var">reifyOr</span> | "ex" =&gt; <span class="id" title="var">reifyExist</span> |  "False" =&gt; <span class="id" title="var">reifyFalse</span> | "True" =&gt; <span class="id" title="var">reifyTrue</span> |<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">_</span> =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">baseLogicConnHelper</span> <span class="id" title="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">None</span> =&gt;<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> ("Unknown connective "++<span class="id" title="var">s</span>) | <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Some</span> <span class="id" title="var">k</span> =&gt; <span class="id" title="var">k</span> <span class="id" title="var">s</span> <span class="id" title="keyword">end</span> <span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
The same development for no-proof mode. Similar, except we don't build proofs 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">baseConnectiveReifierNP</span> := <span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">list</span> <span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">nat</span> -&gt; <span class="id" title="var">Ast.term</span> -&gt; (<span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">FailureMonad</span> <span class="id" title="var">nat</span>) -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">nat</span> -&gt; <span class="id" title="var">Ast.term</span> -&gt; (<span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">FailureMonad</span> <span class="id" title="var">nat</span>) -&gt; <span class="id" title="var">FailureMonad</span> ( <span class="id" title="var">Ast.term</span>)) -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">Ast.term</span> -&gt; (<span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">FailureMonad</span> <span class="id" title="var">nat</span>) -&gt; <span class="id" title="var">FailureMonad</span> (<span class="id" title="var">Ast.term</span>)) -&gt; <span class="id" title="var">FailureMonad</span> (<span class="id" title="var">Ast.term</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">reifyFalseNP</span> : <span class="id" title="var">baseConnectiveReifierNP</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">tct</span> <span class="id" title="var">lst</span> <span class="id" title="var">_</span> <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span> <span class="id" title="var">fPR</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">lst</span> <span class="id" title="keyword">with</span> <span class="id" title="var">nil</span> =&gt; <span class="id" title="var">ret</span> (<span class="id" title="var">tApp</span> <span class="id" title="var">qMergeFormFalse</span> ([<span class="id" title="var">tct</span>])) | <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "False applied to terms" <span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">reifyAndNP</span> : <span class="id" title="var">baseConnectiveReifierNP</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">tct</span> <span class="id" title="var">lst</span> <span class="id" title="var">_</span> <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span> <span class="id" title="var">fPR</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">lst</span> <span class="id" title="keyword">with</span> [<span class="id" title="var">x</span>; <span class="id" title="var">y</span>] =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xt</span> &lt;- <span class="id" title="var">fPR</span> <span class="id" title="var">x</span> 0 <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span>;;<span class="id" title="var">yt</span> &lt;- <span class="id" title="var">fPR</span> <span class="id" title="var">y</span> 0 <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span>;; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ret</span> (<span class="id" title="var">tApp</span> <span class="id" title="var">qMergeFormAnd</span> ([<span class="id" title="var">tct</span>;<span class="id" title="var">xt</span>;<span class="id" title="var">yt</span>])) | <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "And applied to != 2 terms" <span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">reifyOrNP</span>  : <span class="id" title="var">baseConnectiveReifierNP</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">tct</span> <span class="id" title="var">lst</span> <span class="id" title="var">_</span> <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span> <span class="id" title="var">fPR</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">lst</span> <span class="id" title="keyword">with</span> [<span class="id" title="var">x</span>; <span class="id" title="var">y</span>] =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xt</span> &lt;- <span class="id" title="var">fPR</span> <span class="id" title="var">x</span> 0 <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span>;;<span class="id" title="var">yt</span> &lt;- <span class="id" title="var">fPR</span> <span class="id" title="var">y</span> 0 <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span>;; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ret</span> (<span class="id" title="var">tApp</span> <span class="id" title="var">qMergeFormOr</span> ([<span class="id" title="var">tct</span>;<span class="id" title="var">xt</span>;<span class="id" title="var">yt</span>])) | <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "Or applied to != 2 terms" <span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">reifyExistNP</span>:<span class="id" title="var">baseConnectiveReifierNP</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">tct</span> <span class="id" title="var">lst</span> <span class="id" title="var">_</span> <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span> <span class="id" title="var">fPR</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">lst</span> <span class="id" title="keyword">with</span> [<span class="id" title="var">_</span>; <span class="id" title="var">P</span>] =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rt</span> &lt;- <span class="id" title="var">fPR</span> <span class="id" title="var">P</span> 1 <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span>;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ret</span> (<span class="id" title="var">tApp</span> <span class="id" title="var">qMergeFormExists</span> ([<span class="id" title="var">tct</span>;<span class="id" title="var">rt</span>])) | <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "Exist applied to wrong terms" <span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">reifyIffNP</span> : <span class="id" title="var">baseConnectiveReifierNP</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">tct</span> <span class="id" title="var">lst</span> <span class="id" title="var">_</span> <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span> <span class="id" title="var">fPR</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">lst</span> <span class="id" title="keyword">with</span> [<span class="id" title="var">x</span>; <span class="id" title="var">y</span>] =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xt</span> &lt;- <span class="id" title="var">fPR</span> <span class="id" title="var">x</span> 0 <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span>;;<span class="id" title="var">yt</span> &lt;- <span class="id" title="var">fPR</span> <span class="id" title="var">y</span> 0 <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span>;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ret</span> (<span class="id" title="var">tApp</span> <span class="id" title="var">qMergeFormIff</span> ([<span class="id" title="var">tct</span>;<span class="id" title="var">xt</span>;<span class="id" title="var">yt</span>])) | <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "Iff applied to != 2 terms" <span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">reifyTrueNP</span> : <span class="id" title="var">baseConnectiveReifierNP</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">tct</span> <span class="id" title="var">l</span> <span class="id" title="var">fuel</span> <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span> <span class="id" title="var">fPR</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">l</span> <span class="id" title="keyword">with</span> <span class="id" title="var">nil</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ret</span> (<span class="id" title="var">tApp</span> <span class="id" title="var">qMergeFormTrue</span> ([<span class="id" title="var">tct</span>]))| <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "True applied to terms" <span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
The helper is a bit more interesting, since it calls the extension point, building a recursive "dummy proof" helper and discarding the resulting proof 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">reifyBaseNP</span> (<span class="id" title="var">s</span>:<span class="id" title="var">string</span>): <span class="id" title="var">baseConnectiveReifierNP</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="keyword">match</span> <span class="id" title="var">s</span> <span class="id" title="keyword">with</span> "and" =&gt; <span class="id" title="var">reifyAndNP</span> | "or" =&gt; <span class="id" title="var">reifyOrNP</span> | "ex" =&gt; <span class="id" title="var">reifyExistNP</span> |  "False" =&gt; <span class="id" title="var">reifyFalseNP</span> |  "True" =&gt; <span class="id" title="var">reifyTrueNP</span> | <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">_</span> =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">baseLogicConnHelper</span> <span class="id" title="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">None</span> =&gt;<span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> ("Unknown connective "++<span class="id" title="var">s</span>) | <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Some</span> <span class="id" title="var">k</span> =&gt; <span class="id" title="keyword">fun</span> <span class="id" title="var">tct</span> <span class="id" title="var">lst</span> <span class="id" title="var">fuel</span> <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span> <span class="id" title="var">fPR</span> <span class="id" title="var">fTR</span> =&gt; <span class="id" title="var">both</span> &lt;- <span class="id" title="var">k</span> <span class="id" title="var">s</span> <span class="id" title="var">tct</span> <span class="id" title="var">lst</span> <span class="id" title="var">fuel</span> <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">P</span> <span class="id" title="var">n</span> <span class="id" title="var">et</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="var">rr</span> &lt;- <span class="id" title="var">fPR</span> <span class="id" title="var">P</span> <span class="id" title="var">n</span> <span class="id" title="var">et</span> <span class="id" title="var">e</span>;; <span class="id" title="var">ret</span> (<span class="id" title="var">rr</span>, <span class="id" title="var">noProofDummy</span>)) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">tct</span> <span class="id" title="var">t</span> <span class="id" title="var">eT</span> <span class="id" title="var">env</span> =&gt; <span class="id" title="var">rr</span> &lt;- <span class="id" title="var">fTR</span> <span class="id" title="var">tct</span> <span class="id" title="var">t</span> <span class="id" title="var">eT</span> <span class="id" title="var">env</span>;; <span class="id" title="var">ret</span> (<span class="id" title="var">rr</span>, <span class="id" title="var">noProofDummy</span>));; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> '(<span class="id" title="var">trm</span>,<span class="id" title="var">_</span>) := <span class="id" title="var">both</span> <span class="id" title="tactic">in</span> <span class="id" title="var">ret</span> <span class="id" title="var">trm</span> <span class="id" title="keyword">end</span> <span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">TarskiMerging</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">ReificationHelpers</span>.<br/>
</div>

<div class="doc">
**ReificationHelpers
      These functions reify atomic functions/relations  Definition of the types. The arguments are:
<ul class="doclist">
<li> tct:Ast.term - quoted instance of tarski_reflector

</li>
<li> av:list Ast.term - the arguments of an atomic relation/function to be recursively reified

</li>
<li> envTerm

</li>
<li> recursive helper, to which av is passed one-by-one

</li>
<li> the return is again either a pair of term&amp;proof, or just the term if in no proof mode 
</li>
</ul>

</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">termReifier</span> := <span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">list</span> <span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">Ast.term</span> -&gt; (<span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">FailureMonad</span> (<span class="id" title="var">prod</span> <span class="id" title="var">Ast.term</span> <span class="id" title="var">Ast.term</span>)) -&gt; <span class="id" title="var">FailureMonad</span> (<span class="id" title="var">prod</span> <span class="id" title="var">Ast.term</span> <span class="id" title="var">Ast.term</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">termReifierNP</span> := <span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">list</span> <span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">Ast.term</span> -&gt; (<span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">FailureMonad</span> (<span class="id" title="var">Ast.term</span>)) -&gt; <span class="id" title="var">FailureMonad</span> (<span class="id" title="var">Ast.term</span>).<br/>
</div>

<div class="doc">
Args: typeClassTerm -&gt; vector of args -&gt; env term -&gt; recursion for arg vector -&gt; prod (term, proof that term represents input 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">applyRecursively</span> (<span class="id" title="var">lt</span> : <span class="id" title="var">list</span> <span class="id" title="var">Ast.term</span>) (<span class="id" title="var">IH</span> : <span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">FailureMonad</span> (<span class="id" title="var">prod</span> <span class="id" title="var">Ast.term</span> <span class="id" title="var">Ast.term</span>)) : <span class="id" title="var">FailureMonad</span> (<span class="id" title="var">prod</span> (<span class="id" title="var">list</span> <span class="id" title="var">Ast.term</span>) (<span class="id" title="var">list</span> <span class="id" title="var">Ast.term</span>)) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">lt</span> <span class="id" title="keyword">with</span> <span class="id" title="var">nil</span> =&gt; <span class="id" title="var">ret</span> (<span class="id" title="var">nil</span>,<span class="id" title="var">nil</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">t</span>::<span class="id" title="var">tr</span> =&gt; <span class="id" title="var">IHt</span> &lt;- <span class="id" title="var">IH</span> <span class="id" title="var">t</span>;; <span class="id" title="var">atrIH</span> &lt;- <span class="id" title="var">applyRecursively</span> <span class="id" title="var">tr</span> <span class="id" title="var">IH</span>;;<span class="id" title="keyword">let</span> '(<span class="id" title="var">rep</span>,<span class="id" title="var">prf</span>) := <span class="id" title="var">IHt</span> <span class="id" title="tactic">in</span> <span class="id" title="keyword">let</span> '(<span class="id" title="var">replist</span>,<span class="id" title="var">fulllist</span>) := <span class="id" title="var">atrIH</span> <span class="id" title="tactic">in</span> <span class="id" title="var">ret</span> (<span class="id" title="var">rep</span>::<span class="id" title="var">replist</span>, <span class="id" title="var">rep</span>::<span class="id" title="var">t</span>::<span class="id" title="var">prf</span>::<span class="id" title="var">fulllist</span>) <span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">applyRecursivelyNP</span> (<span class="id" title="var">lt</span> : <span class="id" title="var">list</span> <span class="id" title="var">Ast.term</span>) (<span class="id" title="var">IH</span> : <span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">FailureMonad</span> (<span class="id" title="var">Ast.term</span>)) : <span class="id" title="var">FailureMonad</span> ((<span class="id" title="var">list</span> <span class="id" title="var">Ast.term</span>) ) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">lt</span> <span class="id" title="keyword">with</span> <span class="id" title="var">nil</span> =&gt; <span class="id" title="var">ret</span> (<span class="id" title="var">nil</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">t</span>::<span class="id" title="var">tr</span> =&gt; <span class="id" title="var">rep</span> &lt;- <span class="id" title="var">IH</span> <span class="id" title="var">t</span>;; <span class="id" title="var">replist</span> &lt;- <span class="id" title="var">applyRecursivelyNP</span> <span class="id" title="var">tr</span> <span class="id" title="var">IH</span>;;<span class="id" title="var">ret</span> (<span class="id" title="var">rep</span>::<span class="id" title="var">replist</span>) <span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">reifyTerm</span> (<span class="id" title="var">c</span>:<span class="id" title="var">Ast.term</span>) : <span class="id" title="var">termReifier</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">tct</span> <span class="id" title="var">av</span> <span class="id" title="var">env</span> <span class="id" title="var">IH</span> =&gt; <span class="id" title="var">pr</span> &lt;- <span class="id" title="var">applyRecursively</span> <span class="id" title="var">av</span> <span class="id" title="var">IH</span>;; <span class="id" title="keyword">let</span> '(<span class="id" title="var">trm</span>,<span class="id" title="var">fullarg</span>) := <span class="id" title="var">pr</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ret</span> (<span class="id" title="var">tApp</span> <span class="id" title="var">qConstructTerm</span> (<span class="id" title="var">tct</span>::<span class="id" title="var">c</span>::<span class="id" title="var">trm</span>), <span class="id" title="var">tApp</span> <span class="id" title="var">qMergeTerm</span> (<span class="id" title="var">tct</span>::<span class="id" title="var">c</span>::<span class="id" title="var">env</span>::<span class="id" title="var">fullarg</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">reifyForm</span> (<span class="id" title="var">c</span>:<span class="id" title="var">Ast.term</span>) : <span class="id" title="var">termReifier</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">tct</span> <span class="id" title="var">av</span> <span class="id" title="var">env</span> <span class="id" title="var">IH</span> =&gt; <span class="id" title="var">pr</span> &lt;- <span class="id" title="var">applyRecursively</span> <span class="id" title="var">av</span> <span class="id" title="var">IH</span>;; <span class="id" title="keyword">let</span> '(<span class="id" title="var">trm</span>,<span class="id" title="var">fullarg</span>) := <span class="id" title="var">pr</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ret</span> (<span class="id" title="var">tApp</span> <span class="id" title="var">qConstructForm</span> (<span class="id" title="var">tct</span>::<span class="id" title="var">c</span>::<span class="id" title="var">trm</span>), <span class="id" title="var">tApp</span> <span class="id" title="var">qMergeForm</span> (<span class="id" title="var">tct</span>::<span class="id" title="var">c</span>::<span class="id" title="var">env</span>::<span class="id" title="var">fullarg</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">reifyTermNP</span> (<span class="id" title="var">c</span>:<span class="id" title="var">Ast.term</span>) : <span class="id" title="var">termReifierNP</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">tct</span> <span class="id" title="var">av</span> <span class="id" title="var">env</span> <span class="id" title="var">IH</span> =&gt; <span class="id" title="var">trm</span> &lt;- <span class="id" title="var">applyRecursivelyNP</span> <span class="id" title="var">av</span> <span class="id" title="var">IH</span>;; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ret</span> (<span class="id" title="var">tApp</span> <span class="id" title="var">qConstructTerm</span> (<span class="id" title="var">tct</span>::<span class="id" title="var">c</span>::<span class="id" title="var">trm</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">reifyFormNP</span> (<span class="id" title="var">c</span>:<span class="id" title="var">Ast.term</span>) : <span class="id" title="var">termReifierNP</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">tct</span> <span class="id" title="var">av</span> <span class="id" title="var">env</span> <span class="id" title="var">IH</span> =&gt; <span class="id" title="var">trm</span> &lt;- <span class="id" title="var">applyRecursivelyNP</span> <span class="id" title="var">av</span> <span class="id" title="var">IH</span>;; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ret</span> (<span class="id" title="var">tApp</span> <span class="id" title="var">qConstructForm</span> (<span class="id" title="var">tct</span>::<span class="id" title="var">c</span>::<span class="id" title="var">trm</span>)).<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">ReificationHelpers</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">EnvHelpers</span>.<br/>
</div>

<div class="doc">
<a id="lab6"></a><h2 class="section">EnvHelpers</h2>

      Useful functions for extending the environment. A 3-ary predicate P(k1,k2,k3) (for example) is represented by a term t where t in environ (k3:k2:k1:env) represents P (k1,k2,k3). Appends something to the start of the env. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">appendZero</span> (<span class="id" title="var">env</span>:<span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">FailureMonad</span> <span class="id" title="var">nat</span>) (<span class="id" title="var">zv</span>:<span class="id" title="var">FailureMonad</span> <span class="id" title="var">nat</span>) : (<span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">FailureMonad</span> <span class="id" title="var">nat</span>) := <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> (<span class="id" title="var">t</span>:<span class="id" title="var">Ast.term</span>) =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span> <span class="id" title="var">tRel</span> <span class="id" title="var">n</span> =&gt; (<span class="id" title="keyword">match</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span> 0 =&gt; <span class="id" title="var">zv</span> | <span class="id" title="var">S</span> <span class="id" title="var">n</span> =&gt; <span class="id" title="var">env</span> (<span class="id" title="var">tRel</span> <span class="id" title="var">n</span>) <span class="id" title="keyword">end</span>) | <span class="id" title="var">_</span> =&gt; <span class="id" title="var">k</span> &lt;- <span class="id" title="var">lowerRelIndex</span> 0 (<span class="id" title="tactic">fail</span> "tRel 0 used when lowering") <span class="id" title="var">t</span>;; (<span class="id" title="var">env</span> <span class="id" title="var">k</span>) <span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
Appends something to the start of the env. At the same time, it expects the terms given to the env helper to be one level deeper, so it "unshifts" the tRels first 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">appendAndLift</span> (<span class="id" title="var">env</span>:<span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">FailureMonad</span> <span class="id" title="var">nat</span>) (<span class="id" title="var">zv</span>:<span class="id" title="var">FailureMonad</span> <span class="id" title="var">nat</span>) : (<span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">FailureMonad</span> <span class="id" title="var">nat</span>) := <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">t</span> =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span> <span class="id" title="var">tRel</span> <span class="id" title="var">n</span> =&gt; (<span class="id" title="keyword">match</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span> 0 =&gt; <span class="id" title="var">zv</span> | <span class="id" title="var">S</span> <span class="id" title="var">n</span> =&gt; <span class="id" title="var">k</span> &lt;- <span class="id" title="var">env</span> (<span class="id" title="var">tRel</span> <span class="id" title="var">n</span>);;<span class="id" title="var">ret</span> (<span class="id" title="var">S</span> <span class="id" title="var">k</span>) <span class="id" title="keyword">end</span>) | <span class="id" title="var">_</span> =&gt; <span class="id" title="var">k</span> &lt;- <span class="id" title="var">lowerRelIndex</span> 0 (<span class="id" title="tactic">fail</span> "tRel 0 used when lowering") <span class="id" title="var">t</span>;; <span class="id" title="var">v</span> &lt;- <span class="id" title="var">env</span> <span class="id" title="var">k</span>;;<span class="id" title="var">ret</span> (<span class="id" title="var">S</span> <span class="id" title="var">v</span>) <span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">MetaCoq</span> <span class="id" title="var">Quote</span> <span class="id" title="keyword">Definition</span> <span class="id" title="var">qD</span> := @<span class="id" title="var">D</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">MetaCoq</span> <span class="id" title="var">Quote</span> <span class="id" title="keyword">Definition</span> <span class="id" title="var">qScons</span> := @<span class="id" title="var">scons</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">raiseEnvTerm</span> (<span class="id" title="var">tct</span>:<span class="id" title="var">Ast.term</span>) (<span class="id" title="var">d</span>:<span class="id" title="var">Ast.term</span>) (<span class="id" title="var">env</span>:<span class="id" title="var">Ast.term</span>) : <span class="id" title="var">Ast.term</span> := <span class="id" title="var">tApp</span> (<span class="id" title="var">qScons</span>) ([<span class="id" title="var">tApp</span> <span class="id" title="var">qD</span> ([<span class="id" title="var">tct</span>]);<span class="id" title="var">d</span>;<span class="id" title="var">env</span>]).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">unboundEnv</span> := (<span class="id" title="keyword">fun</span> <span class="id" title="var">a</span>:<span class="id" title="var">Ast.term</span> =&gt; @<span class="id" title="tactic">fail</span> <span class="id" title="var">nat</span> ("unbound " ++ <span class="id" title="var">string_of_term</span> <span class="id" title="var">a</span>)).<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">EnvHelpers</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">EnvConstructor</span>.<br/>
</div>

<div class="doc">
<a id="lab7"></a><h2 class="section">EnvConstructor</h2>

      Constructs the environment used to help with free variables in terms  Useful quotations 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="var">Existing</span> <span class="id" title="keyword">Instance</span> <span class="id" title="var">config.default_checker_flags</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">MetaCoq</span> <span class="id" title="var">Quote</span> <span class="id" title="keyword">Definition</span> <span class="id" title="var">qFs</span> := @<span class="id" title="var">fs</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">MetaCoq</span> <span class="id" title="var">Quote</span> <span class="id" title="keyword">Definition</span> <span class="id" title="var">qLocalVar</span> := @<span class="id" title="var">var</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">MetaCoq</span> <span class="id" title="var">Quote</span> <span class="id" title="keyword">Definition</span> <span class="id" title="var">qI_f</span> := @<span class="id" title="var">i_f</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">MetaCoq</span> <span class="id" title="var">Quote</span> <span class="id" title="keyword">Definition</span> <span class="id" title="var">qI_P</span> := @<span class="id" title="var">i_P</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<span class="id" title="var">tr</span> : <span class="id" title="var">tarski_reflector</span>}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<span class="id" title="var">te</span> : <span class="id" title="var">tarski_reflector_extensions</span> <span class="id" title="var">tr</span>}.<br/>
</div>

<div class="doc">
Given a term in the semantic, construct an environment that contains all atoms that appear in the term (and are not otherwise representable) 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">findUBRecursively</span> (<span class="id" title="var">lt</span> : <span class="id" title="var">list</span> <span class="id" title="var">Ast.term</span>) (<span class="id" title="var">IH</span> : <span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">FailureMonad</span> (<span class="id" title="var">list</span> <span class="id" title="var">Ast.term</span>)) : <span class="id" title="var">FailureMonad</span> ((<span class="id" title="var">list</span> <span class="id" title="var">Ast.term</span>) ) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">lt</span> <span class="id" title="keyword">with</span> <span class="id" title="var">nil</span> =&gt; <span class="id" title="var">ret</span> (<span class="id" title="var">nil</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">t</span>::<span class="id" title="var">tr</span> =&gt; <span class="id" title="var">rep</span> &lt;- <span class="id" title="var">IH</span> <span class="id" title="var">t</span>;; <span class="id" title="var">replist</span> &lt;- <span class="id" title="var">findUBRecursively</span> <span class="id" title="var">tr</span> <span class="id" title="var">IH</span>;;<span class="id" title="var">ret</span> (<span class="id" title="var">rep</span>++<span class="id" title="var">replist</span>) <span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
Finds all free variables in a term 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">findUnboundVariablesTerm</span> (<span class="id" title="var">fuel</span>:<span class="id" title="var">nat</span>) (<span class="id" title="var">t</span>:<span class="id" title="var">Ast.term</span>) {<span class="id" title="keyword">struct</span> <span class="id" title="var">fuel</span>}: (<span class="id" title="var">FailureMonad</span> (<span class="id" title="var">list</span> <span class="id" title="var">Ast.term</span>)) := <span class="id" title="keyword">match</span> <span class="id" title="var">fuel</span> <span class="id" title="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 =&gt; <span class="id" title="tactic">fail</span> "Out of fuel" <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">fuel</span> =&gt; <span class="id" title="keyword">let</span> <span class="id" title="var">ffail</span> := <span class="id" title="var">orelse</span> (<span class="id" title="keyword">match</span> @<span class="id" title="var">termReifierVarHelper</span> <span class="id" title="var">_</span> <span class="id" title="var">te</span> <span class="id" title="keyword">with</span> <span class="id" title="var">None</span> =&gt; <span class="id" title="tactic">fail</span> "Fallthrough" | <span class="id" title="var">Some</span> <span class="id" title="var">k</span> =&gt; <span class="id" title="var">k</span> <span class="id" title="var">fuel</span> <span class="id" title="var">t</span> (<span class="id" title="var">findUnboundVariablesTerm</span> <span class="id" title="var">fuel</span>) <span class="id" title="keyword">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span> <span class="id" title="var">tRel</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">ret</span> <span class="id" title="var">nil</span> | <span class="id" title="var">_</span> =&gt; <span class="id" title="var">ret</span> ([<span class="id" title="var">t</span>]) <span class="id" title="keyword">end</span>) <span class="id" title="tactic">in</span> </div>

<div class="doc">
tRel are things introduced by forall/exists and so on, which we do not add to the environment 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">tApp</span> <span class="id" title="var">arg</span> <span class="id" title="var">l</span> =&gt; <span class="id" title="keyword">if</span> <span class="id" title="var">Checker.eq_term</span> <span class="id" title="var">init_graph</span> <span class="id" title="var">arg</span> <span class="id" title="var">qI_f</span> <span class="id" title="keyword">then</span> <span class="id" title="keyword">match</span> <span class="id" title="var">popNElements</span> <span class="id" title="var">l</span> 4 <span class="id" title="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Some</span> ([<span class="id" title="var">fnc</span>;<span class="id" title="var">v</span>]) =&gt; <span class="id" title="var">vr</span> &lt;- <span class="id" title="var">recoverVector</span> <span class="id" title="var">v</span>;;<span class="id" title="var">findUBRecursively</span> <span class="id" title="var">vr</span> (<span class="id" title="var">findUnboundVariablesTerm</span> <span class="id" title="var">fuel</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">ffail</span> <span class="id" title="keyword">end</span> <span class="id" title="keyword">else</span> <span class="id" title="var">ffail</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">ffail</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> <span class="id" title="var">baseLogicConn</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span>:= (<span class="id" title="var">tInd</span> {| <span class="id" title="var">inductive_mind</span> := (<span class="id" title="var">MPfile</span> (["Logic"; "Init"; "Coq"]), <span class="id" title="var">x</span>); <span class="id" title="var">inductive_ind</span> := 0 |} <span class="id" title="var">l</span>).<br/>
</div>

<div class="doc">
Find the unbound variables for our basic forms 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">findUBFalse</span>  :<span class="id" title="var">baseConnectiveVars</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">lst</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">fPR</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">lst</span> <span class="id" title="keyword">with</span> <span class="id" title="var">nil</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ret</span> (<span class="id" title="var">nil</span>) | <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "False applied to terms" <span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">findUBAnd</span>  :<span class="id" title="var">baseConnectiveVars</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">lst</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">fPR</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">lst</span> <span class="id" title="keyword">with</span> [<span class="id" title="var">x</span>; <span class="id" title="var">y</span>] =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xt</span> &lt;- <span class="id" title="var">fPR</span> <span class="id" title="var">x</span> 0;;<span class="id" title="var">yt</span> &lt;- <span class="id" title="var">fPR</span> <span class="id" title="var">y</span> 0;; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ret</span> (<span class="id" title="var">xt</span>++<span class="id" title="var">yt</span>) | <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "And applied to != 2 terms" <span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">findUBOr</span>   :<span class="id" title="var">baseConnectiveVars</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">lst</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">fPR</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">lst</span> <span class="id" title="keyword">with</span> [<span class="id" title="var">x</span>; <span class="id" title="var">y</span>] =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xt</span> &lt;- <span class="id" title="var">fPR</span> <span class="id" title="var">x</span> 0;;<span class="id" title="var">yt</span> &lt;- <span class="id" title="var">fPR</span> <span class="id" title="var">y</span> 0;; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ret</span> (<span class="id" title="var">xt</span>++<span class="id" title="var">yt</span>) | <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "Or applied to != 2 terms" <span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">findUBExists</span>:<span class="id" title="var">baseConnectiveVars</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">lst</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">fPR</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">lst</span> <span class="id" title="keyword">with</span> [<span class="id" title="var">_</span>; <span class="id" title="var">P</span>] =&gt; <span class="id" title="var">fPR</span> <span class="id" title="var">P</span> 1 | <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "Exist applied to wrong terms" <span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">findUBTrue</span> : <span class="id" title="var">baseConnectiveVars</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">lst</span> <span class="id" title="var">fuel</span> <span class="id" title="var">tct</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">lst</span> <span class="id" title="keyword">with</span> <span class="id" title="var">nil</span> =&gt; <span class="id" title="var">ret</span> <span class="id" title="var">nil</span> | <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "True applied to terms" <span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">findUBIff</span>  :<span class="id" title="var">baseConnectiveVars</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">lst</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">fPR</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">lst</span> <span class="id" title="keyword">with</span> [<span class="id" title="var">x</span>; <span class="id" title="var">y</span>] =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xt</span> &lt;- <span class="id" title="var">fPR</span> <span class="id" title="var">x</span> 0;;<span class="id" title="var">yt</span> &lt;- <span class="id" title="var">fPR</span> <span class="id" title="var">y</span> 0;; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ret</span> (<span class="id" title="var">xt</span>++<span class="id" title="var">yt</span>) | <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> "Iff applied to != 2 terms" <span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">findUBBase</span> (<span class="id" title="var">s</span>:<span class="id" title="var">string</span>) : <span class="id" title="var">baseConnectiveVars</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="keyword">match</span> <span class="id" title="var">s</span> <span class="id" title="keyword">with</span> "and" =&gt; <span class="id" title="var">findUBAnd</span> | "or" =&gt; <span class="id" title="var">findUBOr</span> | "ex" =&gt; <span class="id" title="var">findUBExists</span> | "False" =&gt; <span class="id" title="var">findUBFalse</span> | "True" =&gt; <span class="id" title="var">findUBFalse</span> | <span class="id" title="var">_</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> @<span class="id" title="var">baseLogicVarHelper</span> <span class="id" title="var">tr</span> <span class="id" title="var">te</span> <span class="id" title="keyword">with</span> <span class="id" title="var">None</span> =&gt; <span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="tactic">fail</span> ("Unknown connective "++<span class="id" title="var">s</span>) | <span class="id" title="var">Some</span> <span class="id" title="var">k</span> =&gt; <span class="id" title="var">k</span> <span class="id" title="var">s</span> <span class="id" title="keyword">end</span> <span class="id" title="keyword">end</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">MetaCoq</span> <span class="id" title="var">Quote</span> <span class="id" title="keyword">Definition</span> <span class="id" title="var">qIff</span> := @<span class="id" title="var">iff</span>.<br/>
</div>

<div class="doc">
Checks whether a term is the type of theory terms in Coq. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">maybeD</span> : <span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">bool</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">tct</span> <span class="id" title="var">mD</span> =&gt; <span class="id" title="keyword">if</span> @<span class="id" title="var">isD</span> <span class="id" title="var">tr</span> <span class="id" title="var">mD</span> <span class="id" title="keyword">then</span> <span class="id" title="var">true</span> <span class="id" title="keyword">else</span> <span class="id" title="var">Checker.eq_term</span> <span class="id" title="var">init_graph</span> <span class="id" title="var">mD</span> (<span class="id" title="var">tApp</span> <span class="id" title="var">qD</span> ([<span class="id" title="var">tct</span>])).<br/>
</div>

<div class="doc">
Finds the unbound variables in a form 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">findUnboundVariablesForm</span> (<span class="id" title="var">tct</span>:<span class="id" title="var">Ast.term</span>) (<span class="id" title="var">fuel</span>:<span class="id" title="var">nat</span>) (<span class="id" title="var">t</span>:<span class="id" title="var">Ast.term</span>) (<span class="id" title="var">frees</span>:<span class="id" title="var">nat</span>) {<span class="id" title="keyword">struct</span> <span class="id" title="var">fuel</span>}: (<span class="id" title="var">FailureMonad</span> (<span class="id" title="var">list</span> <span class="id" title="var">Ast.term</span>)) := <br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">ffail</span> := <span class="id" title="tactic">fail</span> ("Cannot introspect form "++ <span class="id" title="var">string_of_term</span> <span class="id" title="var">t</span>) <span class="id" title="tactic">in</span> <span class="id" title="keyword">match</span> <span class="id" title="var">fuel</span> <span class="id" title="keyword">with</span> 0 =&gt; <span class="id" title="tactic">fail</span> "Out of fuel" | <span class="id" title="var">S</span> <span class="id" title="var">fuel</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> (<span class="id" title="var">frees</span>,<span class="id" title="var">t</span>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(0,(<span class="id" title="var">baseLogicConn</span> <span class="id" title="var">name</span> <span class="id" title="var">nil</span>)) =&gt; <span class="id" title="var">findUBBase</span> <span class="id" title="var">name</span> <span class="id" title="var">nil</span> <span class="id" title="var">fuel</span> <span class="id" title="var">tct</span> (<span class="id" title="var">findUnboundVariablesForm</span> <span class="id" title="var">tct</span> <span class="id" title="var">fuel</span>) (<span class="id" title="var">findUnboundVariablesTerm</span> <span class="id" title="var">fuel</span>)<br/>
&nbsp;&nbsp;| (0,(<span class="id" title="var">tApp</span> (<span class="id" title="var">baseLogicConn</span> <span class="id" title="var">name</span> <span class="id" title="var">nil</span>) <span class="id" title="var">lst</span>)) =&gt; <span class="id" title="var">findUBBase</span> <span class="id" title="var">name</span> <span class="id" title="var">lst</span> <span class="id" title="var">fuel</span> <span class="id" title="var">tct</span> (<span class="id" title="var">findUnboundVariablesForm</span> <span class="id" title="var">tct</span> <span class="id" title="var">fuel</span>) (<span class="id" title="var">findUnboundVariablesTerm</span> <span class="id" title="var">fuel</span>)<br/>
&nbsp;&nbsp;| (0,(<span class="id" title="var">tApp</span> <span class="id" title="var">arg</span> <span class="id" title="var">lst</span>)) =&gt; <span class="id" title="keyword">if</span> <span class="id" title="var">Checker.eq_term</span> <span class="id" title="var">init_graph</span> <span class="id" title="var">arg</span> <span class="id" title="var">qI_P</span> <span class="id" title="keyword">then</span> <span class="id" title="keyword">match</span> <span class="id" title="var">popNElements</span> <span class="id" title="var">lst</span> 4 <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Some</span> ([<span class="id" title="var">fnc</span>;<span class="id" title="var">v</span>]) =&gt; <span class="id" title="var">vr</span> &lt;- <span class="id" title="var">recoverVector</span> <span class="id" title="var">v</span>;;<span class="id" title="var">findUBRecursively</span> <span class="id" title="var">vr</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">t</span> =&gt; <span class="id" title="var">findUnboundVariablesTerm</span> <span class="id" title="var">fuel</span> <span class="id" title="var">t</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">ffail</span>  <span class="id" title="keyword">end</span> <span class="id" title="keyword">else</span> <span class="id" title="keyword">if</span> <span class="id" title="var">Checker.eq_term</span> <span class="id" title="var">init_graph</span> <span class="id" title="var">arg</span> <span class="id" title="var">qIff</span> <span class="id" title="keyword">then</span> <span class="id" title="var">findUBIff</span> <span class="id" title="var">lst</span> <span class="id" title="var">fuel</span> <span class="id" title="var">tct</span> (<span class="id" title="var">findUnboundVariablesForm</span> <span class="id" title="var">tct</span> <span class="id" title="var">fuel</span>) (<span class="id" title="var">findUnboundVariablesTerm</span> <span class="id" title="var">fuel</span>) <span class="id" title="keyword">else</span> <span class="id" title="var">ffail</span> <br/>
&nbsp;&nbsp;| (0,<span class="id" title="var">tProd</span> <span class="id" title="var">x</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span>) =&gt; <span class="id" title="keyword">if</span> <span class="id" title="var">maybeD</span> <span class="id" title="var">tct</span> (<span class="id" title="var">P</span>) <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">findUnboundVariablesForm</span> <span class="id" title="var">tct</span> <span class="id" title="var">fuel</span> (<span class="id" title="var">tLambda</span> <span class="id" title="var">x</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span>) 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rP</span> &lt;- <span class="id" title="var">findUnboundVariablesForm</span> <span class="id" title="var">tct</span> <span class="id" title="var">fuel</span> <span class="id" title="var">P</span> 0;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Ql</span> &lt;- <span class="id" title="var">lowerRelIndex</span> 0 (<span class="id" title="tactic">fail</span> "Used var of implication precondition") <span class="id" title="var">Q</span>;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rQ</span> &lt;- <span class="id" title="var">findUnboundVariablesForm</span> <span class="id" title="var">tct</span> <span class="id" title="var">fuel</span> <span class="id" title="var">Ql</span> 0;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ret</span> (<span class="id" title="var">rP</span>++<span class="id" title="var">rQ</span>)<br/>
&nbsp;&nbsp;| (<span class="id" title="var">S</span> <span class="id" title="var">n</span>,<span class="id" title="var">tLambda</span> <span class="id" title="var">x</span> <span class="id" title="var">T</span> <span class="id" title="var">P</span>) =&gt; <span class="id" title="keyword">if</span> <span class="id" title="var">maybeD</span> <span class="id" title="var">tct</span> <span class="id" title="var">T</span> <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">findUnboundVariablesForm</span> <span class="id" title="var">tct</span> <span class="id" title="var">fuel</span> <span class="id" title="var">P</span> <span class="id" title="var">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">ffail</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">ffail</span>  <span class="id" title="keyword">end</span> <span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
Builds the actual env out of a list of free variables 
</div>
<div class="code">
&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">createEnvTerms</span> (<span class="id" title="var">tct</span>:<span class="id" title="var">Ast.term</span>) (<span class="id" title="var">l</span>:<span class="id" title="var">list</span> <span class="id" title="var">Ast.term</span>) (<span class="id" title="var">base</span>:<span class="id" title="var">Ast.term</span>) : <span class="id" title="var">prod</span> (<span class="id" title="var">Ast.term</span>) (<span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">FailureMonad</span> <span class="id" title="var">nat</span>) := <span class="id" title="keyword">match</span> <span class="id" title="var">l</span> <span class="id" title="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">nil</span> =&gt; (<span class="id" title="var">base</span>,<span class="id" title="var">unboundEnv</span>)<br/>
&nbsp;&nbsp;&nbsp;| <span class="id" title="var">x</span>::<span class="id" title="var">xr</span> =&gt; <span class="id" title="keyword">let</span> '(<span class="id" title="var">envTerm</span>,<span class="id" title="var">env</span>) := <span class="id" title="var">createEnvTerms</span> <span class="id" title="var">tct</span> <span class="id" title="var">xr</span> <span class="id" title="var">base</span> <span class="id" title="tactic">in</span> (<span class="id" title="var">raiseEnvTerm</span> <span class="id" title="var">tct</span> <span class="id" title="var">x</span> <span class="id" title="var">envTerm</span>, <span class="id" title="keyword">fun</span> <span class="id" title="var">a</span>:<span class="id" title="var">Ast.term</span> =&gt; <span class="id" title="keyword">if</span> <span class="id" title="var">Checker.eq_term</span> <span class="id" title="var">init_graph</span> <span class="id" title="var">x</span> <span class="id" title="var">a</span> <span class="id" title="keyword">then</span> <span class="id" title="var">ret</span> 0 <span class="id" title="keyword">else</span> <span class="id" title="var">v</span> &lt;- <span class="id" title="var">env</span> <span class="id" title="var">a</span>;;<span class="id" title="var">ret</span> (<span class="id" title="var">S</span> <span class="id" title="var">v</span>)) <span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">EnvConstructor</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">MainReificationFunctions</span>.<br/>
</div>

<div class="doc">
<a id="lab8"></a><h2 class="section">MainReificationFunctions</h2>

  Constructs the actual reifications, putting everything together 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<span class="id" title="var">tr</span> : <span class="id" title="var">tarski_reflector</span>}.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Context</span> {<span class="id" title="var">te</span> : <span class="id" title="var">tarski_reflector_extensions</span> <span class="id" title="var">tr</span>}.<br/>
&nbsp;&nbsp;<span class="id" title="var">Existing</span> <span class="id" title="keyword">Instance</span> <span class="id" title="var">config.default_checker_flags</span>.<br/>
</div>

<div class="doc">
<a id="lab9"></a><h3 class="section">Terms</h3>

   Constructs the representation for terms. Arguments:
<ul class="doclist">
<li> tct -- the quoted instance of tarski_reflector

</li>
<li> fuel -- fuel

</li>
<li> t -- the term to reify

</li>
<li> termEnv -- the env term

</li>
<li> env -- the env helper

</li>
<li> returns the pair of reification/proof 
</li>
</ul>

</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">findTermRepresentation</span> (<span class="id" title="var">tct</span>:<span class="id" title="var">Ast.term</span>) (<span class="id" title="var">fuel</span>:<span class="id" title="var">nat</span>) (<span class="id" title="var">t</span>:<span class="id" title="var">Ast.term</span>) (<span class="id" title="var">termEnv</span>:<span class="id" title="var">Ast.term</span>) (<span class="id" title="var">env</span>:<span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">FailureMonad</span> <span class="id" title="var">nat</span>) {<span class="id" title="keyword">struct</span> <span class="id" title="var">fuel</span>}: (<span class="id" title="var">FailureMonad</span> (<span class="id" title="var">prod</span> <span class="id" title="var">Ast.term</span> <span class="id" title="var">Ast.term</span>)) := <span class="id" title="keyword">match</span> <span class="id" title="var">fuel</span> <span class="id" title="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 =&gt; <span class="id" title="tactic">fail</span> "Out of fuel" <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">fuel</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">fallback</span> := <span class="id" title="var">orelse</span> (<span class="id" title="keyword">match</span> @<span class="id" title="var">termReifierReifyHelper</span> <span class="id" title="var">_</span> <span class="id" title="var">te</span> <span class="id" title="keyword">with</span> <span class="id" title="var">None</span> =&gt; <span class="id" title="tactic">fail</span> "none" | <span class="id" title="var">Some</span> <span class="id" title="var">k</span> =&gt; <span class="id" title="var">k</span> <span class="id" title="var">tct</span> <span class="id" title="var">fuel</span> <span class="id" title="var">t</span> <span class="id" title="var">termEnv</span> <span class="id" title="var">env</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">l</span> =&gt; <span class="id" title="var">findTermRepresentation</span> <span class="id" title="var">l</span> <span class="id" title="var">fuel</span>) <span class="id" title="keyword">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">envv</span> &lt;- <span class="id" title="var">env</span> (<span class="id" title="var">t</span>);;<span class="id" title="keyword">let</span> <span class="id" title="var">num</span> := <span class="id" title="var">quoteNumber</span> (<span class="id" title="var">envv</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">ret</span> (<span class="id" title="var">tApp</span> <span class="id" title="var">qLocalVar</span> ([<span class="id" title="var">tApp</span> <span class="id" title="var">qFs</span> ([<span class="id" title="var">tct</span>]);<span class="id" title="var">num</span>]),<span class="id" title="var">tApp</span> <span class="id" title="var">qeq_refl</span> ([<span class="id" title="var">tApp</span> <span class="id" title="var">qD</span> ([<span class="id" title="var">tct</span>]);<span class="id" title="var">t</span>]))) <span class="id" title="tactic">in</span> <span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">tApp</span> <span class="id" title="var">arg</span> <span class="id" title="var">l</span> =&gt; <span class="id" title="keyword">if</span> <span class="id" title="var">Checker.eq_term</span> <span class="id" title="var">init_graph</span> <span class="id" title="var">arg</span> <span class="id" title="var">qI_f</span> <span class="id" title="keyword">then</span> <span class="id" title="keyword">match</span> <span class="id" title="var">popNElements</span> <span class="id" title="var">l</span> 4 <span class="id" title="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Some</span> ([<span class="id" title="var">fnc</span>;<span class="id" title="var">v</span>]) =&gt; <span class="id" title="var">vr</span> &lt;- <span class="id" title="var">recoverVector</span> <span class="id" title="var">v</span>;;<span class="id" title="var">reifyTerm</span> <span class="id" title="var">fnc</span> <span class="id" title="var">tct</span> <span class="id" title="var">vr</span> <span class="id" title="var">termEnv</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">t</span> =&gt; <span class="id" title="var">findTermRepresentation</span> <span class="id" title="var">tct</span> <span class="id" title="var">fuel</span> <span class="id" title="var">t</span> <span class="id" title="var">termEnv</span> <span class="id" title="var">env</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">fallback</span> <span class="id" title="keyword">end</span> <span class="id" title="keyword">else</span> <span class="id" title="var">fallback</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">fallback</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
Like the above, but without the proof 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">findTermRepresentationNP</span> (<span class="id" title="var">tct</span>:<span class="id" title="var">Ast.term</span>) (<span class="id" title="var">fuel</span>:<span class="id" title="var">nat</span>) (<span class="id" title="var">t</span>:<span class="id" title="var">Ast.term</span>) (<span class="id" title="var">termEnv</span>:<span class="id" title="var">Ast.term</span>) (<span class="id" title="var">env</span>:<span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">FailureMonad</span> <span class="id" title="var">nat</span>) {<span class="id" title="keyword">struct</span> <span class="id" title="var">fuel</span>}: (<span class="id" title="var">FailureMonad</span> (<span class="id" title="var">Ast.term</span>)) := <span class="id" title="keyword">match</span> <span class="id" title="var">fuel</span> <span class="id" title="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 =&gt; <span class="id" title="tactic">fail</span> "Out of fuel" <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">fuel</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">fallback</span> := <span class="id" title="var">orelse</span> (<span class="id" title="keyword">match</span> @<span class="id" title="var">termReifierReifyHelper</span> <span class="id" title="var">_</span> <span class="id" title="var">te</span> <span class="id" title="keyword">with</span> <span class="id" title="var">None</span> =&gt; <span class="id" title="tactic">fail</span> "none" | <span class="id" title="var">Some</span> <span class="id" title="var">k</span> =&gt; <span class="id" title="var">pr</span> &lt;- <span class="id" title="var">k</span> <span class="id" title="var">tct</span> <span class="id" title="var">fuel</span> <span class="id" title="var">t</span> <span class="id" title="var">termEnv</span> <span class="id" title="var">env</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">tct'</span> <span class="id" title="var">t'</span> <span class="id" title="var">te'</span> <span class="id" title="var">e'</span> =&gt; <span class="id" title="var">v</span> &lt;- <span class="id" title="var">findTermRepresentationNP</span> <span class="id" title="var">tct'</span> <span class="id" title="var">fuel</span> <span class="id" title="var">t'</span> <span class="id" title="var">te'</span> <span class="id" title="var">e'</span>;;<span class="id" title="var">ret</span> (<span class="id" title="var">v</span>,<span class="id" title="var">noProofDummy</span>));; <span class="id" title="keyword">let</span> '(<span class="id" title="var">pr1</span>,<span class="id" title="var">pr2</span>) := <span class="id" title="var">pr</span> <span class="id" title="tactic">in</span> <span class="id" title="var">ret</span> <span class="id" title="var">pr1</span> <span class="id" title="keyword">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">envv</span> &lt;- <span class="id" title="var">env</span> (<span class="id" title="var">t</span>);;<span class="id" title="keyword">let</span> <span class="id" title="var">num</span> := <span class="id" title="var">quoteNumber</span> (<span class="id" title="var">envv</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">ret</span> (<span class="id" title="var">tApp</span> <span class="id" title="var">qLocalVar</span> ([<span class="id" title="var">tApp</span> <span class="id" title="var">qFs</span> ([<span class="id" title="var">tct</span>]);<span class="id" title="var">num</span>]))) <span class="id" title="tactic">in</span> <span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">tApp</span> <span class="id" title="var">arg</span> <span class="id" title="var">l</span> =&gt; <span class="id" title="keyword">if</span> <span class="id" title="var">Checker.eq_term</span> <span class="id" title="var">init_graph</span> <span class="id" title="var">arg</span> <span class="id" title="var">qI_f</span> <span class="id" title="keyword">then</span> <span class="id" title="keyword">match</span> <span class="id" title="var">popNElements</span> <span class="id" title="var">l</span> 4 <span class="id" title="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Some</span> ([<span class="id" title="var">fnc</span>;<span class="id" title="var">v</span>]) =&gt; <span class="id" title="var">vr</span> &lt;- <span class="id" title="var">recoverVector</span> <span class="id" title="var">v</span>;;<span class="id" title="var">reifyTermNP</span> <span class="id" title="var">fnc</span> <span class="id" title="var">tct</span> <span class="id" title="var">vr</span> <span class="id" title="var">termEnv</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">t</span> =&gt; <span class="id" title="var">findTermRepresentationNP</span> <span class="id" title="var">tct</span> <span class="id" title="var">fuel</span> <span class="id" title="var">t</span> <span class="id" title="var">termEnv</span> <span class="id" title="var">env</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">fallback</span> <span class="id" title="keyword">end</span> <span class="id" title="keyword">else</span> <span class="id" title="var">fallback</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">fallback</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> <span class="id" title="var">baseLogicConn</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span>:= (<span class="id" title="var">tInd</span> {| <span class="id" title="var">inductive_mind</span> := (<span class="id" title="var">MPfile</span> (["Logic"; "Init"; "Coq"]), <span class="id" title="var">x</span>); <span class="id" title="var">inductive_ind</span> := 0 |} <span class="id" title="var">l</span>).<br/>
</div>

<div class="doc">
<a id="lab10"></a><h3 class="section">Forms</h3>

</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">findPropRepresentation</span> (<span class="id" title="var">tct</span>:<span class="id" title="var">Ast.term</span>) (<span class="id" title="var">fuel</span>:<span class="id" title="var">nat</span>) (<span class="id" title="var">t</span>:<span class="id" title="var">Ast.term</span>) (<span class="id" title="var">frees</span>:<span class="id" title="var">nat</span>) (<span class="id" title="var">envTerm</span>:<span class="id" title="var">Ast.term</span>) (<span class="id" title="var">env</span>:<span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">FailureMonad</span> <span class="id" title="var">nat</span>) {<span class="id" title="keyword">struct</span> <span class="id" title="var">fuel</span>}: (<span class="id" title="var">FailureMonad</span> (<span class="id" title="var">prod</span> <span class="id" title="var">Ast.term</span> <span class="id" title="var">Ast.term</span>)) := <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">fuel</span> <span class="id" title="keyword">with</span> 0 =&gt; <span class="id" title="tactic">fail</span> "Out of fuel" | <span class="id" title="var">S</span> <span class="id" title="var">fuel</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">ffail</span> := <span class="id" title="var">orelse</span> (<span class="id" title="keyword">match</span> @<span class="id" title="var">formReifierReifyHelper</span> <span class="id" title="var">_</span> <span class="id" title="var">te</span> <span class="id" title="keyword">with</span> <span class="id" title="var">None</span> =&gt; <span class="id" title="tactic">fail</span> "none" | <span class="id" title="var">Some</span> <span class="id" title="var">k</span> =&gt; <span class="id" title="var">k</span> <span class="id" title="var">tct</span> <span class="id" title="var">fuel</span> <span class="id" title="var">t</span> <span class="id" title="var">frees</span> <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span> (<span class="id" title="var">findPropRepresentation</span> <span class="id" title="var">tct</span> <span class="id" title="var">fuel</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">l</span> =&gt; <span class="id" title="var">findTermRepresentation</span> <span class="id" title="var">l</span> <span class="id" title="var">fuel</span>) <span class="id" title="keyword">end</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">fail</span> ("Cannot represent form " ++ <span class="id" title="var">string_of_term</span> <span class="id" title="var">t</span>)) <span class="id" title="tactic">in</span> <span class="id" title="keyword">match</span> (<span class="id" title="var">frees</span>,<span class="id" title="var">t</span>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(0,(<span class="id" title="var">baseLogicConn</span> <span class="id" title="var">name</span> <span class="id" title="var">nil</span>)) =&gt; <span class="id" title="var">reifyBase</span> <span class="id" title="var">name</span> <span class="id" title="var">tct</span> <span class="id" title="var">nil</span> <span class="id" title="var">fuel</span> <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span> (<span class="id" title="var">findPropRepresentation</span> <span class="id" title="var">tct</span> <span class="id" title="var">fuel</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">tct</span> =&gt; <span class="id" title="var">findTermRepresentation</span> <span class="id" title="var">tct</span> <span class="id" title="var">fuel</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| (0,(<span class="id" title="var">tApp</span> (<span class="id" title="var">baseLogicConn</span> <span class="id" title="var">name</span> <span class="id" title="var">nil</span>) <span class="id" title="var">lst</span>)) =&gt; <span class="id" title="var">reifyBase</span> <span class="id" title="var">name</span> <span class="id" title="var">tct</span> <span class="id" title="var">lst</span> <span class="id" title="var">fuel</span> <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span> (<span class="id" title="var">findPropRepresentation</span> <span class="id" title="var">tct</span> <span class="id" title="var">fuel</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">tct</span> =&gt; <span class="id" title="var">findTermRepresentation</span> <span class="id" title="var">tct</span> <span class="id" title="var">fuel</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| (0,(<span class="id" title="var">tApp</span> <span class="id" title="var">arg</span> <span class="id" title="var">lst</span>)) =&gt; <span class="id" title="keyword">if</span> <span class="id" title="var">Checker.eq_term</span> <span class="id" title="var">init_graph</span> <span class="id" title="var">arg</span> <span class="id" title="var">qI_P</span> <span class="id" title="keyword">then</span> <span class="id" title="keyword">match</span> <span class="id" title="var">popNElements</span> <span class="id" title="var">lst</span> 4 <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Some</span> ([<span class="id" title="var">fnc</span>;<span class="id" title="var">v</span>]) =&gt; <span class="id" title="var">vr</span> &lt;- <span class="id" title="var">recoverVector</span> <span class="id" title="var">v</span>;;<span class="id" title="var">reifyForm</span> <span class="id" title="var">fnc</span> <span class="id" title="var">tct</span> <span class="id" title="var">vr</span> <span class="id" title="var">envTerm</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">t</span> =&gt; <span class="id" title="var">findTermRepresentation</span> <span class="id" title="var">tct</span> <span class="id" title="var">fuel</span> <span class="id" title="var">t</span> <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">ffail</span> <span class="id" title="keyword">end</span> <span class="id" title="keyword">else</span> <span class="id" title="keyword">if</span> <span class="id" title="var">Checker.eq_term</span> <span class="id" title="var">init_graph</span> <span class="id" title="var">arg</span> <span class="id" title="var">qIff</span> <span class="id" title="keyword">then</span> <span class="id" title="var">reifyIff</span> <span class="id" title="var">tct</span> <span class="id" title="var">lst</span> <span class="id" title="var">fuel</span> <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span> (<span class="id" title="var">findPropRepresentation</span> <span class="id" title="var">tct</span> <span class="id" title="var">fuel</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">tct</span> =&gt; <span class="id" title="var">findTermRepresentation</span> <span class="id" title="var">tct</span> <span class="id" title="var">fuel</span>) <span class="id" title="keyword">else</span> <span class="id" title="var">ffail</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| (0,<span class="id" title="var">tProd</span> <span class="id" title="var">x</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span>) =&gt; <span class="id" title="keyword">if</span> <span class="id" title="var">maybeD</span> <span class="id" title="var">tct</span> (<span class="id" title="var">P</span>) <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rQ</span> &lt;- <span class="id" title="var">findPropRepresentation</span> <span class="id" title="var">tct</span> <span class="id" title="var">fuel</span> (<span class="id" title="var">tLambda</span> <span class="id" title="var">x</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span>) 1 <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span>;; <span class="id" title="keyword">let</span> '(<span class="id" title="var">tQ</span>,<span class="id" title="var">pQ</span>) := <span class="id" title="var">rQ</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ret</span> (<span class="id" title="var">tApp</span> <span class="id" title="var">qMergeFormForall</span> ([<span class="id" title="var">tct</span>;<span class="id" title="var">tQ</span>]), <span class="id" title="var">tApp</span> <span class="id" title="var">qMergeForall</span> ([<span class="id" title="var">tct</span>;<span class="id" title="var">envTerm</span>;<span class="id" title="var">tLambda</span> <span class="id" title="var">x</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span>;<span class="id" title="var">tQ</span>;<span class="id" title="var">pQ</span>]))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rP</span> &lt;- <span class="id" title="var">findPropRepresentation</span> <span class="id" title="var">tct</span> <span class="id" title="var">fuel</span> <span class="id" title="var">P</span> 0 <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span>;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Ql</span> &lt;- <span class="id" title="var">lowerRelIndex</span> 0 (<span class="id" title="tactic">fail</span> "Used var of implication precondition") <span class="id" title="var">Q</span>;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rQ</span> &lt;- <span class="id" title="var">findPropRepresentation</span> <span class="id" title="var">tct</span> <span class="id" title="var">fuel</span> <span class="id" title="var">Ql</span> 0 <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span>;; <span class="id" title="keyword">let</span> '((<span class="id" title="var">tP</span>,<span class="id" title="var">pP</span>),(<span class="id" title="var">tQ</span>,<span class="id" title="var">pQ</span>)) := (<span class="id" title="var">rP</span>,<span class="id" title="var">rQ</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ret</span> (<span class="id" title="var">tApp</span> <span class="id" title="var">qMergeFormImpl</span> ([<span class="id" title="var">tct</span>;<span class="id" title="var">tP</span>;<span class="id" title="var">tQ</span>]), <span class="id" title="var">tApp</span> <span class="id" title="var">qMergeImpl</span> ([<span class="id" title="var">tct</span>;<span class="id" title="var">envTerm</span>;<span class="id" title="var">P</span>;<span class="id" title="var">Ql</span>;<span class="id" title="var">tP</span>;<span class="id" title="var">tQ</span>;<span class="id" title="var">pP</span>;<span class="id" title="var">pQ</span>]))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" title="var">S</span> <span class="id" title="var">n</span>,<span class="id" title="var">tLambda</span> <span class="id" title="var">x</span> <span class="id" title="var">T</span> <span class="id" title="var">P</span>) =&gt; <span class="id" title="keyword">if</span> <span class="id" title="var">maybeD</span> <span class="id" title="var">tct</span> <span class="id" title="var">T</span> <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">envTermSub</span> := <span class="id" title="var">raiseEnvTerm</span> <span class="id" title="var">tct</span> (<span class="id" title="var">tRel</span> 0) (<span class="id" title="var">addRelIndex</span> 0 1 <span class="id" title="var">envTerm</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">envSub</span> := <span class="id" title="var">appendAndLift</span> <span class="id" title="var">env</span> (<span class="id" title="var">ret</span> 0) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">k</span> &lt;- <span class="id" title="var">findPropRepresentation</span> <span class="id" title="var">tct</span> <span class="id" title="var">fuel</span> <span class="id" title="var">P</span> <span class="id" title="var">n</span> <span class="id" title="var">envTermSub</span> <span class="id" title="var">envSub</span>;; <span class="id" title="keyword">let</span> '(<span class="id" title="var">tk</span>,<span class="id" title="var">pk</span>) := <span class="id" title="var">k</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ret</span> (<span class="id" title="var">tk</span>,(<span class="id" title="var">tLambda</span> <span class="id" title="var">x</span> (<span class="id" title="var">tApp</span> <span class="id" title="var">qD</span> ([<span class="id" title="var">tct</span>])) <span class="id" title="var">pk</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">ffail</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">ffail</span> <span class="id" title="keyword">end</span> <span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
like the above but again the no-proof version 
</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">findPropRepresentationNP</span> (<span class="id" title="var">tct</span>:<span class="id" title="var">Ast.term</span>) (<span class="id" title="var">fuel</span>:<span class="id" title="var">nat</span>) (<span class="id" title="var">t</span>:<span class="id" title="var">Ast.term</span>) (<span class="id" title="var">frees</span>:<span class="id" title="var">nat</span>) (<span class="id" title="var">envTerm</span>:<span class="id" title="var">Ast.term</span>) (<span class="id" title="var">env</span>:<span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">FailureMonad</span> <span class="id" title="var">nat</span>) {<span class="id" title="keyword">struct</span> <span class="id" title="var">fuel</span>}: (<span class="id" title="var">FailureMonad</span> (<span class="id" title="var">Ast.term</span>)) := <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">fuel</span> <span class="id" title="keyword">with</span> 0 =&gt; <span class="id" title="tactic">fail</span> "Out of fuel" | <span class="id" title="var">S</span> <span class="id" title="var">fuel</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">ffail</span> := <span class="id" title="var">orelse</span> (<span class="id" title="keyword">match</span> @<span class="id" title="var">formReifierReifyHelper</span> <span class="id" title="var">_</span> <span class="id" title="var">te</span> <span class="id" title="keyword">with</span> <span class="id" title="var">None</span> =&gt; <span class="id" title="tactic">fail</span> "none" | <span class="id" title="var">Some</span> <span class="id" title="var">k</span> =&gt; <span class="id" title="var">rr</span> &lt;- <span class="id" title="var">k</span> <span class="id" title="var">tct</span> <span class="id" title="var">fuel</span> <span class="id" title="var">t</span> <span class="id" title="var">frees</span> <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">t</span> <span class="id" title="var">f</span> <span class="id" title="var">et</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="var">v</span> &lt;- <span class="id" title="var">findPropRepresentationNP</span> <span class="id" title="var">tct</span> <span class="id" title="var">fuel</span> <span class="id" title="var">t</span> <span class="id" title="var">f</span> <span class="id" title="var">et</span> <span class="id" title="var">e</span>;; <span class="id" title="var">ret</span> (<span class="id" title="var">v</span>,<span class="id" title="var">noProofDummy</span>)) (<span class="id" title="keyword">fun</span> <span class="id" title="var">l</span> <span class="id" title="var">t</span> <span class="id" title="var">et</span> <span class="id" title="var">e</span> =&gt; <span class="id" title="var">v</span> &lt;- <span class="id" title="var">findTermRepresentationNP</span> <span class="id" title="var">l</span> <span class="id" title="var">fuel</span> <span class="id" title="var">t</span> <span class="id" title="var">et</span> <span class="id" title="var">e</span>;;<span class="id" title="var">ret</span> (<span class="id" title="var">v</span>,<span class="id" title="var">noProofDummy</span>));;<span class="id" title="keyword">let</span> '(<span class="id" title="var">trm</span>,<span class="id" title="var">_</span>) := <span class="id" title="var">rr</span> <span class="id" title="tactic">in</span> <span class="id" title="var">ret</span> <span class="id" title="var">trm</span> <span class="id" title="keyword">end</span>)  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">fail</span> ("Cannot represent form " ++ <span class="id" title="var">string_of_term</span> <span class="id" title="var">t</span>)) <span class="id" title="tactic">in</span> <span class="id" title="keyword">match</span> (<span class="id" title="var">frees</span>,<span class="id" title="var">t</span>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(0,(<span class="id" title="var">baseLogicConn</span> <span class="id" title="var">name</span> <span class="id" title="var">nil</span>)) =&gt; <span class="id" title="var">reifyBaseNP</span> <span class="id" title="var">name</span> <span class="id" title="var">tct</span> <span class="id" title="var">nil</span> <span class="id" title="var">fuel</span> <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span> (<span class="id" title="var">findPropRepresentationNP</span> <span class="id" title="var">tct</span> <span class="id" title="var">fuel</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">tct</span> =&gt; <span class="id" title="var">findTermRepresentationNP</span> <span class="id" title="var">tct</span> <span class="id" title="var">fuel</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| (0,(<span class="id" title="var">tApp</span> (<span class="id" title="var">baseLogicConn</span> <span class="id" title="var">name</span> <span class="id" title="var">nil</span>) <span class="id" title="var">lst</span>)) =&gt; <span class="id" title="var">reifyBaseNP</span> <span class="id" title="var">name</span> <span class="id" title="var">tct</span> <span class="id" title="var">lst</span> <span class="id" title="var">fuel</span> <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span> (<span class="id" title="var">findPropRepresentationNP</span> <span class="id" title="var">tct</span> <span class="id" title="var">fuel</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">tct</span> =&gt; <span class="id" title="var">findTermRepresentationNP</span> <span class="id" title="var">tct</span> <span class="id" title="var">fuel</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| (0,(<span class="id" title="var">tApp</span> <span class="id" title="var">arg</span> <span class="id" title="var">lst</span>)) =&gt; <span class="id" title="keyword">if</span> <span class="id" title="var">Checker.eq_term</span> <span class="id" title="var">init_graph</span> <span class="id" title="var">arg</span> <span class="id" title="var">qI_P</span> <span class="id" title="keyword">then</span> <span class="id" title="keyword">match</span> <span class="id" title="var">popNElements</span> <span class="id" title="var">lst</span> 4 <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Some</span> ([<span class="id" title="var">fnc</span>;<span class="id" title="var">v</span>]) =&gt; <span class="id" title="var">vr</span> &lt;- <span class="id" title="var">recoverVector</span> <span class="id" title="var">v</span>;;<span class="id" title="var">reifyFormNP</span> <span class="id" title="var">fnc</span> <span class="id" title="var">tct</span> <span class="id" title="var">vr</span> <span class="id" title="var">envTerm</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">t</span> =&gt; <span class="id" title="var">findTermRepresentationNP</span> <span class="id" title="var">tct</span> <span class="id" title="var">fuel</span> <span class="id" title="var">t</span> <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">ffail</span> <span class="id" title="keyword">end</span> <span class="id" title="keyword">else</span> <span class="id" title="keyword">if</span> <span class="id" title="var">Checker.eq_term</span> <span class="id" title="var">init_graph</span> <span class="id" title="var">arg</span> <span class="id" title="var">qIff</span> <span class="id" title="keyword">then</span> <span class="id" title="var">reifyIffNP</span> <span class="id" title="var">tct</span> <span class="id" title="var">lst</span> <span class="id" title="var">fuel</span> <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span> (<span class="id" title="var">findPropRepresentationNP</span> <span class="id" title="var">tct</span> <span class="id" title="var">fuel</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">tct</span> =&gt; <span class="id" title="var">findTermRepresentationNP</span> <span class="id" title="var">tct</span> <span class="id" title="var">fuel</span>) <span class="id" title="keyword">else</span> <span class="id" title="var">ffail</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| (0,<span class="id" title="var">tProd</span> <span class="id" title="var">x</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span>) =&gt; <span class="id" title="keyword">if</span> <span class="id" title="var">maybeD</span> <span class="id" title="var">tct</span> (<span class="id" title="var">P</span>) <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">tQ</span> &lt;- <span class="id" title="var">findPropRepresentationNP</span> <span class="id" title="var">tct</span> <span class="id" title="var">fuel</span> (<span class="id" title="var">tLambda</span> <span class="id" title="var">x</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span>) 1 <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span>;; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ret</span> (<span class="id" title="var">tApp</span> <span class="id" title="var">qMergeFormForall</span> ([<span class="id" title="var">tct</span>;<span class="id" title="var">tQ</span>]))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">tP</span> &lt;- <span class="id" title="var">findPropRepresentationNP</span> <span class="id" title="var">tct</span> <span class="id" title="var">fuel</span> <span class="id" title="var">P</span> 0 <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span>;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Ql</span> &lt;- <span class="id" title="var">lowerRelIndex</span> 0 (<span class="id" title="tactic">fail</span> "Used var of implication precondition") <span class="id" title="var">Q</span>;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">tQ</span> &lt;- <span class="id" title="var">findPropRepresentationNP</span> <span class="id" title="var">tct</span> <span class="id" title="var">fuel</span> <span class="id" title="var">Ql</span> 0 <span class="id" title="var">envTerm</span> <span class="id" title="var">env</span>;; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ret</span> (<span class="id" title="var">tApp</span> <span class="id" title="var">qMergeFormImpl</span> ([<span class="id" title="var">tct</span>;<span class="id" title="var">tP</span>;<span class="id" title="var">tQ</span>]))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" title="var">S</span> <span class="id" title="var">n</span>,<span class="id" title="var">tLambda</span> <span class="id" title="var">x</span> <span class="id" title="var">T</span> <span class="id" title="var">P</span>) =&gt; <span class="id" title="keyword">if</span> <span class="id" title="var">maybeD</span> <span class="id" title="var">tct</span> <span class="id" title="var">T</span> <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">envTermSub</span> := <span class="id" title="var">raiseEnvTerm</span> <span class="id" title="var">tct</span> (<span class="id" title="var">tRel</span> 0) (<span class="id" title="var">addRelIndex</span> 0 1 <span class="id" title="var">envTerm</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">envSub</span> := <span class="id" title="var">appendAndLift</span> <span class="id" title="var">env</span> (<span class="id" title="var">ret</span> 0) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">tk</span> &lt;- <span class="id" title="var">findPropRepresentationNP</span> <span class="id" title="var">tct</span> <span class="id" title="var">fuel</span> <span class="id" title="var">P</span> <span class="id" title="var">n</span> <span class="id" title="var">envTermSub</span> <span class="id" title="var">envSub</span>;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ret</span> (<span class="id" title="var">tk</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">ffail</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">ffail</span> <span class="id" title="keyword">end</span> <span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">MainReificationFunctions</span>.<br/>

<br/>
</div>

<div class="doc">
Default fuel. This is enough for all terms with depth 100 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">FUEL</span> := 100.<br/>
</div>

<div class="doc">
<a id="lab11"></a><h2 class="section">Tactics</h2>

 All tactics expect the goal to be representable n P  Tactic that calls findPropRepresentation. Given an env (unquoted) and a respective env helper 
</div>
<div class="code">
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">representEnvP</span> <span class="id" title="var">env</span> <span class="id" title="var">env2</span>:= <br/>
<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> [ |- @<span class="id" title="var">representableP</span> ?<span class="id" title="var">i</span> ?<span class="id" title="var">n</span> ?<span class="id" title="var">G</span> ] =&gt;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">rep</span> := <span class="id" title="tactic">fresh</span> "rep" <span class="id" title="tactic">in</span> <span class="id" title="keyword">let</span> <span class="id" title="var">prf</span> := <span class="id" title="tactic">fresh</span> "prf" <span class="id" title="tactic">in</span> <span class="id" title="keyword">let</span> <span class="id" title="var">k</span> <span class="id" title="var">y</span> := (<span class="id" title="tactic">destruct</span> <span class="id" title="var">y</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">rep</span> <span class="id" title="var">prf</span>]) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;(<span class="id" title="var">run_template_program</span> (<span class="id" title="var">monad_utils.bind</span> (<span class="id" title="var">tmQuote</span> <span class="id" title="var">i</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">tct</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">monad_utils.bind</span> (<span class="id" title="var">tmQuote</span> <span class="id" title="var">G</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">g</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">monad_utils.bind</span> (<span class="id" title="var">tmInferInstance</span> <span class="id" title="var">None</span> (<span class="id" title="var">tarski_reflector_extensions</span> <span class="id" title="var">i</span>)) (<span class="id" title="keyword">fun</span> <span class="id" title="var">treO</span> =&gt; <span class="id" title="keyword">let</span> <span class="id" title="var">tre</span> := <span class="id" title="keyword">match</span> <span class="id" title="var">treO</span> <span class="id" title="keyword">with</span> <span class="id" title="var">my_Some</span> <span class="id" title="var">kk</span> =&gt; <span class="id" title="var">kk</span> | <span class="id" title="var">my_None</span> =&gt; <span class="id" title="var">defaultExtensions</span> <span class="id" title="var">i</span> <span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">monad_utils.bind</span> (<span class="id" title="var">tmQuote</span> <span class="id" title="var">env</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">qe</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">monad_utils.bind</span> (<span class="id" title="var">f2t</span> (@<span class="id" title="var">findPropRepresentation</span> <span class="id" title="var">i</span> <span class="id" title="var">tre</span> <span class="id" title="var">tct</span> <span class="id" title="var">FUEL</span> <span class="id" title="var">g</span> <span class="id" title="var">n</span> <span class="id" title="var">qe</span> <span class="id" title="var">env2</span>)) (<span class="id" title="keyword">fun</span> '(<span class="id" title="var">tPq</span>,<span class="id" title="var">pPq</span>) =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">monad_utils.bind</span> (<span class="id" title="var">tmUnquoteTyped</span> (<span class="id" title="var">form</span>) <span class="id" title="var">tPq</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">tP</span>:<span class="id" title="var">form</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">monad_utils.bind</span> (<span class="id" title="var">tmUnquoteTyped</span> (@<span class="id" title="var">representsP</span> <span class="id" title="var">i</span> <span class="id" title="var">n</span> <span class="id" title="var">tP</span> <span class="id" title="var">env</span> <span class="id" title="var">G</span>) <span class="id" title="var">pPq</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">tQ</span> : @<span class="id" title="var">representsP</span> <span class="id" title="var">i</span> <span class="id" title="var">n</span> <span class="id" title="var">tP</span> <span class="id" title="var">env</span> <span class="id" title="var">G</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">monad_utils.ret</span> (@<span class="id" title="var">existT</span> <span class="id" title="var">form</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">mm</span> =&gt; @<span class="id" title="var">representsP</span> <span class="id" title="var">i</span> <span class="id" title="var">n</span> <span class="id" title="var">mm</span> <span class="id" title="var">env</span> <span class="id" title="var">G</span>) <span class="id" title="var">tP</span> <span class="id" title="var">tQ</span>))))))))) <span class="id" title="var">k</span>)<br/>
&nbsp;&nbsp;;<span class="id" title="tactic">exists</span> <span class="id" title="var">rep</span>;<span class="id" title="tactic">exists</span> <span class="id" title="var">env</span>;<span class="id" title="tactic">exact</span> <span class="id" title="var">prf</span> <br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Like the above, but no-proof mode. We hope easy can proof it, if not the user must close (or alternatively try  representEnvP )
</div>
<div class="code">
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">representEnvPNP</span> <span class="id" title="var">env</span> <span class="id" title="var">env2</span>:= <br/>
<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> [ |- @<span class="id" title="var">representableP</span> ?<span class="id" title="var">i</span> ?<span class="id" title="var">n</span> ?<span class="id" title="var">G</span> ] =&gt;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">rep</span> := <span class="id" title="tactic">fresh</span> "rep" <span class="id" title="tactic">in</span> <span class="id" title="keyword">let</span> <span class="id" title="var">prf</span> := <span class="id" title="tactic">fresh</span> "prf" <span class="id" title="tactic">in</span> <span class="id" title="keyword">let</span> <span class="id" title="var">k</span> <span class="id" title="var">y</span> := (<span class="id" title="tactic">pose</span> <span class="id" title="var">y</span> <span class="id" title="keyword">as</span> <span class="id" title="var">rep</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;(<span class="id" title="var">run_template_program</span> (<span class="id" title="var">monad_utils.bind</span> (<span class="id" title="var">tmQuote</span> <span class="id" title="var">i</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">tct</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">monad_utils.bind</span> (<span class="id" title="var">tmQuote</span> <span class="id" title="var">G</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">g</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">monad_utils.bind</span> (<span class="id" title="var">tmInferInstance</span> <span class="id" title="var">None</span> (<span class="id" title="var">tarski_reflector_extensions</span> <span class="id" title="var">i</span>)) (<span class="id" title="keyword">fun</span> <span class="id" title="var">treO</span> =&gt; <span class="id" title="keyword">let</span> <span class="id" title="var">tre</span> := <span class="id" title="keyword">match</span> <span class="id" title="var">treO</span> <span class="id" title="keyword">with</span> <span class="id" title="var">my_Some</span> <span class="id" title="var">kk</span> =&gt; <span class="id" title="var">kk</span> | <span class="id" title="var">my_None</span> =&gt; <span class="id" title="var">defaultExtensions</span> <span class="id" title="var">i</span> <span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">monad_utils.bind</span> (<span class="id" title="var">tmQuote</span> <span class="id" title="var">env</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">qe</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">monad_utils.bind</span> (<span class="id" title="var">f2t</span> ((@<span class="id" title="var">findPropRepresentationNP</span> <span class="id" title="var">i</span> <span class="id" title="var">tre</span> <span class="id" title="var">tct</span> <span class="id" title="var">FUEL</span> <span class="id" title="var">g</span> <span class="id" title="var">n</span> <span class="id" title="var">qe</span> <span class="id" title="var">env2</span>))) (<span class="id" title="keyword">fun</span> <span class="id" title="var">tPq</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">monad_utils.bind</span> (<span class="id" title="var">tmUnquoteTyped</span> (<span class="id" title="var">form</span>) <span class="id" title="var">tPq</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">tP</span>:<span class="id" title="var">form</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">monad_utils.ret</span> (<span class="id" title="var">tP</span>)))))))) <span class="id" title="var">k</span>)<br/>
&nbsp;&nbsp;;<span class="id" title="tactic">exists</span> <span class="id" title="var">rep</span>;<span class="id" title="tactic">exists</span> <span class="id" title="var">env</span>;<span class="id" title="tactic">try</span> <span class="id" title="var">easy</span> <br/>
<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Construct the environment, then invoke another ltac with the build environment and the respective env helper (continuation-passing style) 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">HiddenTerm</span> {<span class="id" title="var">X</span>:<span class="id" title="keyword">Type</span>} {<span class="id" title="var">x</span>:<span class="id" title="var">X</span>} := <span class="id" title="var">x</span>.<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">constructEnvCont</span> <span class="id" title="var">cont</span> := <br/>
<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> [ |- @<span class="id" title="var">representableP</span> ?<span class="id" title="var">i</span> ?<span class="id" title="var">n</span> ?<span class="id" title="var">G</span> ] =&gt; <br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;(<span class="id" title="var">run_template_program</span> (<span class="id" title="var">monad_utils.bind</span> (<span class="id" title="var">tmQuote</span> <span class="id" title="var">i</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">tct</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">monad_utils.bind</span> (<span class="id" title="var">tmQuote</span> <span class="id" title="var">G</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">g</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">monad_utils.bind</span> (<span class="id" title="var">tmInferInstance</span> <span class="id" title="var">None</span> (<span class="id" title="var">tarski_reflector_extensions</span> <span class="id" title="var">i</span>)) (<span class="id" title="keyword">fun</span> <span class="id" title="var">treO</span> =&gt; <span class="id" title="keyword">let</span> <span class="id" title="var">tre</span> := <span class="id" title="keyword">match</span> <span class="id" title="var">treO</span> <span class="id" title="keyword">with</span> <span class="id" title="var">my_Some</span> <span class="id" title="var">kk</span> =&gt; <span class="id" title="var">kk</span> | <span class="id" title="var">my_None</span> =&gt; <span class="id" title="var">defaultExtensions</span> <span class="id" title="var">i</span> <span class="id" title="keyword">end</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">monad_utils.bind</span> (<span class="id" title="var">tmQuote</span> (@<span class="id" title="var">emptyEnv</span> <span class="id" title="var">i</span>)) (<span class="id" title="keyword">fun</span> <span class="id" title="var">baseEnv</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">monad_utils.bind</span> (<span class="id" title="var">f2t</span> ((@<span class="id" title="var">findUnboundVariablesForm</span> <span class="id" title="var">i</span> <span class="id" title="var">tre</span> <span class="id" title="var">tct</span> <span class="id" title="var">FUEL</span> <span class="id" title="var">g</span> <span class="id" title="var">n</span>))) (<span class="id" title="keyword">fun</span> <span class="id" title="var">lst</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> '(<span class="id" title="var">envToDR</span>,<span class="id" title="var">envToNat</span>) := (<span class="id" title="var">createEnvTerms</span> <span class="id" title="var">tct</span> <span class="id" title="var">lst</span> <span class="id" title="var">baseEnv</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">monad_utils.bind</span> (<span class="id" title="var">tmUnquoteTyped</span> (<span class="id" title="var">nat</span> -&gt; @<span class="id" title="var">D</span> <span class="id" title="var">i</span>) <span class="id" title="var">envToDR</span>) (<span class="id" title="keyword">fun</span> <span class="id" title="var">envToD</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">monad_utils.ret</span> (<span class="id" title="var">pair</span> <span class="id" title="var">envToD</span> <span class="id" title="var">envToNat</span>)))))))) <span class="id" title="var">cont</span>)<br/>
<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
Construct the env, then bind it to envBase and envTerm. Useful if one does not actually want to show representability with the automation but just build the environment
</div>
<div class="code">
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">constructEnv'</span> <span class="id" title="var">envBase</span> <span class="id" title="var">envTerm</span> := <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> [ |- @<span class="id" title="var">representableP</span> ?<span class="id" title="var">i</span> ?<span class="id" title="var">n</span> ?<span class="id" title="var">G</span> ] =&gt; <span class="id" title="keyword">let</span> <span class="id" title="var">k</span> <span class="id" title="var">y</span> := (<span class="id" title="tactic">pose</span> (@<span class="id" title="var">HiddenTerm</span> (<span class="id" title="var">nat</span> -&gt; @<span class="id" title="var">D</span> <span class="id" title="var">i</span>) (<span class="id" title="var">fst</span> <span class="id" title="var">y</span>)) <span class="id" title="keyword">as</span> <span class="id" title="var">envBase</span>;<span class="id" title="tactic">pose</span> (@<span class="id" title="var">HiddenTerm</span> (<span class="id" title="var">Ast.term</span> -&gt; <span class="id" title="var">FailureMonad</span> <span class="id" title="var">nat</span>) (<span class="id" title="var">snd</span> <span class="id" title="var">y</span>)) <span class="id" title="keyword">as</span> <span class="id" title="var">envTerm</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">constructEnvCont</span> <span class="id" title="var">k</span> <span class="id" title="keyword">end</span>.<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">constructEnv</span> := <span class="id" title="keyword">let</span> <span class="id" title="var">envBase</span> := <span class="id" title="tactic">fresh</span> "envBase" <span class="id" title="tactic">in</span> <span class="id" title="keyword">let</span> <span class="id" title="var">envTerm</span> := <span class="id" title="tactic">fresh</span> "envTerm" <span class="id" title="tactic">in</span> <span class="id" title="var">constructEnv'</span> <span class="id" title="var">envBase</span> <span class="id" title="var">envTerm</span>.<br/>

<br/>
</div>

<div class="doc">
The main tactic. Builds an environment, finds a reification and a proof of correctness. Calls the above tactics 
</div>
<div class="code">
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">represent</span> := <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> [ |- @<span class="id" title="var">representableP</span> ?<span class="id" title="var">i</span> ?<span class="id" title="var">n</span> ?<span class="id" title="var">G</span> ] =&gt; <span class="id" title="keyword">let</span> <span class="id" title="var">tac</span> <span class="id" title="var">k</span> := (<span class="id" title="keyword">let</span> <span class="id" title="var">envBase</span> := <span class="id" title="tactic">fresh</span> "envBase" <span class="id" title="tactic">in</span> (<span class="id" title="tactic">pose</span> (@<span class="id" title="var">HiddenTerm</span> (<span class="id" title="var">nat</span> -&gt; @<span class="id" title="var">D</span> <span class="id" title="var">i</span>) (<span class="id" title="var">fst</span> <span class="id" title="var">k</span>)) <span class="id" title="keyword">as</span> <span class="id" title="var">envBase</span>); <span class="id" title="var">representEnvP</span> <span class="id" title="var">envBase</span> (<span class="id" title="var">snd</span> <span class="id" title="var">k</span>)) <span class="id" title="tactic">in</span> <span class="id" title="var">constructEnvCont</span> <span class="id" title="var">tac</span> <span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
The same, but without the proof 
</div>
<div class="code">
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">representNP</span> := <span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> [ |- @<span class="id" title="var">representableP</span> ?<span class="id" title="var">i</span> ?<span class="id" title="var">n</span> ?<span class="id" title="var">G</span> ] =&gt; <span class="id" title="keyword">let</span> <span class="id" title="var">tac</span> <span class="id" title="var">k</span> := (<span class="id" title="keyword">let</span> <span class="id" title="var">envBase</span> := <span class="id" title="tactic">fresh</span> "envBase" <span class="id" title="tactic">in</span> (<span class="id" title="tactic">pose</span> (@<span class="id" title="var">HiddenTerm</span> (<span class="id" title="var">nat</span> -&gt; @<span class="id" title="var">D</span> <span class="id" title="var">i</span>) (<span class="id" title="var">fst</span> <span class="id" title="var">k</span>)) <span class="id" title="keyword">as</span> <span class="id" title="var">envBase</span>); <span class="id" title="var">representEnvPNP</span> <span class="id" title="var">envBase</span> (<span class="id" title="var">snd</span> <span class="id" title="var">k</span>)) <span class="id" title="tactic">in</span> <span class="id" title="var">constructEnvCont</span> <span class="id" title="var">tac</span> <span class="id" title="keyword">end</span>.<br/>

<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>